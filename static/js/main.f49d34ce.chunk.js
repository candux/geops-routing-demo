(this["webpackJsonpgeops-routing-demo"]=this["webpackJsonpgeops-routing-demo"]||[]).push([[0],{354:function(e,t,n){e.exports=n(569)},564:function(e,t,n){},566:function(e,t,n){},568:function(e,t,n){},569:function(e,t,n){"use strict";n.r(t);n(355),n(364),n(554);var r=n(0),a=n.n(r),o=n(29),c=n.n(o),i=n(56),l=n(80),u=n(316),s=n(106),d={currentMot:"bus",currentStops:["",""],currentStopsGeoJSON:{},clickLocation:null,notificationMessage:"",notificationType:"info",isFieldFocused:!1},p=function(e,t){var n={currentStops:t.currentStops};return Object(s.a)({},e,{},n)},m=function(e,t){var n={currentStopsGeoJSON:t.currentStopsGeoJSON};return Object(s.a)({},e,{},n)},f=function(e,t){var n={currentMot:t.currentMot};return Object(s.a)({},e,{},n)},h=function(e,t){var n={clickLocation:t.clickLocation};return Object(s.a)({},e,{},n)},b=function(e,t){var n={notificationMessage:t.notificationMessage,notificationType:t.notificationType};return Object(s.a)({},e,{},n)},g=function(e,t){var n={isFieldFocused:t.isFieldFocused};return Object(s.a)({},e,{},n)},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CURRENT_STOPS":return p(e,t);case"SET_CURRENT_STOPS_GEOJSON":return m(e,t);case"SET_CURRENT_MOT":return f(e,t);case"SET_CLICK_LOCATION":return h(e,t);case"SHOW_NOTIFICATION":return b(e,t);case"SET_IS_FIELD_FOCUSED":return g(e,t);default:return e}},S=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||l.d,y=Object(l.c)({MapReducer:v}),E=Object(l.e)(y,S(Object(l.a)(u.a))),O=n(142),k=n(102),w=n(186),C=n(187),j=n(204),R=n(627),N=n(327),F=n(14),x=n(626),P=n(110),T=n(317),I=n.n(T),_=n(68),A=n.n(_),M=n(206),V=n(631),G=n(314),H=n(203),L=n(635),z=n(53),U=n(616),J=n(612),D=n(632),W=n(629),Z=n(623),q=n(624),K=n(628),B=n(622),X=n(208),$=n(625),Q=n(207),Y=n(189),ee=n.n(Y),te=function(e){return{type:"SET_CURRENT_STOPS",currentStops:e}},ne=function(e){return{type:"SET_CURRENT_STOPS_GEOJSON",currentStopsGeoJSON:e}},re=function(e){return{type:"SET_CURRENT_MOT",currentMot:e}},ae=function(e,t){return{type:"SHOW_NOTIFICATION",notificationMessage:e,notificationType:t}},oe=function(e){return{type:"SET_IS_FIELD_FOCUSED",isFieldFocused:e}},ce=(n(564),["rail","bus","foot"]),ie=["tram","subway","gondola","funicular","ferry","car"],le=[].concat(ce,ie),ue=["foot","car"],se=n(320),de=n.n(se),pe=n(318),me=n.n(pe),fe=n(319),he=n.n(fe),be=function(e){var t=null,n=e.charAt(0).toUpperCase()+e.slice(1);switch(e){case"rail":t=a.a.createElement(me.a,null);break;case"foot":t=a.a.createElement(he.a,null);break;default:t=a.a.createElement(de.a,null)}return a.a.createElement("span",{title:n},t)},ge=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;return Object(F.m)(e,"EPSG:3857","EPSG:4326").map((function(e){return e.toFixed(t)}))},ve=n(613),Se=n(570),ye=n(615),Ee=n(614),Oe=n(241),ke=n.n(Oe),we=function(e,t){return e&&t?"".concat(e," - ").concat(t):e||t?e||t:null};function Ce(e){var t=e.currentSearchResults,n=e.processClickedResultHandler;return 0===t.length?null:a.a.createElement(J.a,{square:!0,elevation:3},a.a.createElement(ve.a,{component:"nav","aria-label":"search results"},t.map((function(e,t){return 0!==t?a.a.createElement(Se.a,{onClick:function(){n(e)},button:!0,key:ee()()},a.a.createElement(Ee.a,null,a.a.createElement(ke.a,null)),a.a.createElement(ye.a,{primary:e.properties.name,secondary:we(e.properties.code,e.properties.country_code)})):a.a.createElement(Se.a,{onClick:function(){return n(e)},button:!0,selected:!0,key:"searchResult-".concat(e.properties.name)},a.a.createElement(Ee.a,null,a.a.createElement(ke.a,null)),a.a.createElement(ye.a,{primary:e.properties.name,secondary:we(e.properties.code,e.properties.country_code)}))}))))}Ce.defaultProps={currentSearchResults:[]};var je=Ce,Re=n(619),Ne=n(634),Fe=n(618),xe=n(637),Pe=n(325),Te=n.n(Pe),Ie=n(323),_e=n.n(Ie),Ae=n(242),Me=n.n(Ae),Ve=n(326),Ge=n.n(Ve),He=n(322),Le=n.n(He),ze=n(324),Ue=n.n(ze),Je=n(9),De=n.n(Je),We=De.a.arrayOf(De.a.number.isRequired).isRequired,Ze=De.a.shape({coordinates:We,type:De.a.string.isRequired}),qe=De.a.shape({geometry:Ze,properties:De.a.shape({id:De.a.oneOfType([De.a.string.isRequired,De.a.string.isRequired]),type:De.a.string.isRequired}),type:De.a.string.isRequired}),Ke=De.a.shape({features:De.a.shape({0:De.a.oneOfType([qe,We]),1:De.a.oneOfType([qe,We])}),type:De.a.string.isRequired}),Be=(De.a.shape({0:Ke,1:Ke}),De.a.arrayOf(De.a.oneOfType([De.a.string.isRequired,We])),Object(U.a)((function(){return{gridContainer:{width:"100%",padding:"0px 0px 0px 20px",boxSizing:"unset"},button:{color:"black","& svg":{height:"20px",width:"20px"}},fieldWrapper:{maxWidth:"75%"},buttonWrapper:{maxWidth:"26px"}}})));function Xe(e){var t,n=Be(),r=Object(i.c)(),o=e.index,c=e.addNewSearchFieldHandler,l=e.currentStops,u=e.removeSearchFieldHandler,s=e.searchStopsHandler,d=e.singleStop,p=e.processHighlightedResultSelectHandler,m=e.onFieldFocusHandler,f=e.onZoomRouteClick,h=e.isActiveRoute,b=e.onPanViaClick,g=e.inputReference,v=null,S=10,y="",E=null,O=""===l[o]||l.length>2&&""===l[o+1];return 0===o?(v=a.a.createElement(xe.a,{title:"Pan to the feature"},a.a.createElement(Fe.a,{onClick:function(){return b(d,o)},className:n.button,"aria-label":"Pan to the feature",size:"small"},a.a.createElement(Le.a,{fontSize:"small",color:"primary"}))),y="Start",E=a.a.createElement(Re.a,{item:!0,xs:1,className:n.buttonWrapper},a.a.createElement(xe.a,{title:"Add Hop"},a.a.createElement(Fe.a,{onClick:function(){return c(l,o+1)},disabled:O,className:n.button,"aria-label":"Add Hop",size:"small"},a.a.createElement(Me.a,{fontSize:"small"}))))):o===l.length-1?(v=a.a.createElement(xe.a,{title:"Pan to the feature"},a.a.createElement(Fe.a,{onClick:function(){return b(d,o)},className:n.button,"aria-label":"Pan to the feature",size:"small"},a.a.createElement(_e.a,{color:"primary"}))),y="End",E=a.a.createElement(Re.a,{item:!0,xs:1,className:n.buttonWrapper},a.a.createElement(xe.a,{title:"Zoom to the route"},a.a.createElement(Fe.a,{onClick:function(){return f()},disabled:!h,className:n.button,"aria-label":"Zoom to the route",size:"small"},a.a.createElement(Ue.a,{fontSize:"small"}))))):(v=a.a.createElement(xe.a,{title:"Pan to the feature"},a.a.createElement(Fe.a,{onClick:function(){return b(d,o)},className:n.button,"aria-label":"Pan to the feature",size:"small"},a.a.createElement(Te.a,{fontSize:"small",color:"primary"}))),S=9,y="Hop",E=a.a.createElement(a.a.Fragment,null,a.a.createElement(Re.a,{item:!0,xs:1,className:n.buttonWrapper},a.a.createElement(xe.a,{title:"Add Hop"},a.a.createElement(Fe.a,{disabled:O,onClick:function(){return c(l,o+1)},className:n.button,"aria-label":"addHop",size:"small"},a.a.createElement(Me.a,{fontSize:"small"})))),a.a.createElement(Re.a,{item:!0,xs:1,className:n.buttonWrapper},a.a.createElement(xe.a,{title:"Remove Hop"},a.a.createElement(Fe.a,{onClick:function(){return u(o)},className:n.button,"aria-label":"removeHop",size:"small"},a.a.createElement(Ge.a,{fontSize:"small"})))))),a.a.createElement(Re.a,{container:!0,spacing:1,className:n.gridContainer,alignItems:"flex-end"},a.a.createElement(Re.a,{item:!0,xs:1},v),a.a.createElement(Re.a,{item:!0,xs:S,className:n.fieldWrapper},a.a.createElement(Ne.a,{style:{width:"100%"},inputRef:g,label:y,color:"primary",onChange:function(e){return s(e,o)},value:(t=d,Array.isArray(t)?ge(t):t),onKeyDown:p,onFocus:function(){r(oe(!0)),m(o)},onBlur:function(){return setTimeout((function(){r(oe(!1))}),500)},onClick:function(e){e.target.select&&e.target.select()}})),E)}Xe.defaultProps={currentStops:[],singleStop:""};var $e=Xe;function Qe(e){var t=e.children,n=e.value,r=e.index;return a.a.createElement(X.a,{component:"div",role:"tabpanel",hidden:n!==r,id:ee()(),"aria-labelledby":"simple-tab-".concat(r)},n===r&&t)}var Ye=Object(U.a)((function(){return{tabs:{width:"75%"},tab:{minWidth:"33%",width:"33%"},dropDown:{width:"25%",backgroundColor:"white"},select:{height:"100%"},selectInput:{backgroundColor:"white","&:focus":{backgroundColor:"white"}},checkbox:{padding:"20px 23px"}}})),et=new AbortController;function tt(e){var t=e.mots,n=e.stationSearchUrl,o=e.APIKey,c=e.isActiveRoute,l=e.onZoomRouteClick,u=e.onPanViaClick,d=Ye(),p=Object(i.c)(),m=function(e,t){var n=[];return e.filter((function(e){return t.includes(e)})).forEach((function(e){var r=t.find((function(t){return t===e}));r&&n.push({name:r,icon:be(r)})})),0===n.length&&n.push({name:le[0],icon:be(le[0])}),n},f=m(t,ce),h=m(t,ie),b=Object(i.d)((function(e){return e.MapReducer.clickLocation})),g=Object(i.d)((function(e){return e.MapReducer.currentStops})),v=Object(i.d)((function(e){return e.MapReducer.currentStopsGeoJSON})),S=a.a.useRef([]);S.current.length!==g.length&&(S.current=Array(g.length).fill().map((function(e,t){return S.current[t]||a.a.createRef()})));var y=Object(r.useState)(f),E=Object(z.a)(y,1)[0],O=Object(r.useState)(f[0].name),k=Object(z.a)(O,2),w=k[0],C=k[1],j=Object(r.useState)(h),R=Object(z.a)(j,1)[0],N=Object(r.useState)(null),x=Object(z.a)(N,2),P=x[0],T=x[1],I=Object(r.useState)([]),_=Object(z.a)(I,2),M=_[0],V=_[1],G=a.a.useState(!0),H=Object(z.a)(G,2),L=H[0],U=H[1],X=Object(r.useState)(0),Y=Object(z.a)(X,2),ee=Y[0],se=Y[1],de=Object(r.useState)(!1),pe=Object(z.a)(de,2),me=pe[0],fe=pe[1],he=Object(r.useState)(void 0),ge=Object(z.a)(he,2),ve=ge[0],Se=ge[1];Object(r.useEffect)((function(){p(re(E[0].name))}),[]);var ye=function(e,t,n){p(te(e)),p(ne(t)),se(n)},Ee=function(e,t){var n=A.a.clone(v),r={type:"FeatureCollection",features:[{type:"Feature",properties:{id:b.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:b}}]};n[ee]=r,ye(e,n,t),p(ne(n))};Object(r.useEffect)((function(){if(b)if(""===g[ee]){g[ee]=b,Ee(g,ee+1<g.length?ee+1:ee)}else{var e=g,t=ee;e[ee]=b,Ee(e,ee);var n=A.a.clone(v),r={type:"FeatureCollection",features:[{type:"Feature",properties:{id:b.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:b}}]};n[ee]=r,ye(e,n,t),p(ne(n))}}),[b]);var Oe=function(e,t){Se(null),C(t),p(re(t))},ke=function(e){se(e),p(oe(!0))},we=function(e,t){var n=A.a.clone(g),r=A.a.clone(v);(n.splice(t,0,""),r[t])&&Object.keys(r).filter((function(e){return e>=t})).reverse().forEach((function(e){r["".concat(parseInt(e,10)+1)]=r[e]}));p(te(n)),p(ne(r))},Ce=function(e){var t=A.a.clone(g),n=A.a.clone(v);if(t.splice(e,1),n[e]){var r=Object.keys(n);r.forEach((function(t){var r=parseInt(t,10);r===e?delete n[e]:r>e&&(n[r-1]=n[r])})),delete n[r.length-1]}p(te(t)),p(ne(n))},Re=function(e,t){if(T(t),!e.target.value){var r=g;return r[t]="",V([]),p(te(r)),void fe(!1)}var a=A.a.clone(g);a[t]=e.target.value,p(te(a)),fe(!0),et.abort();var c=(et=new AbortController).signal,i="".concat(n,"?q=").concat(e.target.value,"&key=").concat(o).concat(ue.includes(w)?"":"&mots=".concat(L?w:""));fetch(i,{signal:c}).then((function(e){return e.json()})).then((function(e){e.error?p(ae("Couldn't find stations","warning")):(0===e.features.length&&p(ae("Couldn't find stations","warning")),V(e.features),fe(!1))})).catch((function(e){if("AbortError"!==e.name)throw e;console.warn("Abort ".concat(i))}))},Ne=function(e){var t=Object(z.a)(M,1)[0];if("Enter"===e.key&&t){var n=g;ye[ee]=t.properties.name;var r=A.a.clone(v);r[ee]=t,p(te(n)),V([]),p(ne(r))}if("Backspace"===e.key){var a=[];e.target.value&&(a=M);var o={};Object.keys(v).forEach((function(e){e!==ee.toString()&&(o[e]=v[e])})),V(a),p(ne(o))}};return l&&u?a.a.createElement("div",{className:"rd-routing-menu"},a.a.createElement(J.a,{square:!0,elevation:3},a.a.createElement("div",{className:"rd-routing-menu-header"},a.a.createElement(W.a,{value:!!ce.includes(w)&&w,className:d.tabs,onChange:function(e,t){Oe(0,t)},indicatorColor:"primary",textColor:"primary","aria-label":"mots icons"},E.map((function(e){return a.a.createElement(Z.a,{className:d.tab,key:"mot-".concat(e.name),value:e.name,icon:e.icon,"aria-label":e.name})}))),a.a.createElement(B.a,{className:d.dropDown},a.a.createElement(K.a,{renderValue:function(e){return""!==e?e:"Other MOTs"},className:d.select,classes:{root:d.selectInput},labelId:"rd-other-mot-label",value:ve||"",disableUnderline:!ve,displayEmpty:!0,onChange:function(e){if(e){var t=e.target.value;Oe(0,t),Se(t)}else Se(null)}},R.map((function(e){return a.a.createElement(q.a,{value:e.name,key:"other-mot-".concat(e.name)},e.name)}))))),a.a.createElement(Qe,null,a.a.createElement(Q.a,{onDragEnd:function(e){if(e.destination){var t=A.a.clone(g),n=t.splice(e.source.index,1),r=Object(z.a)(n,1)[0];t.splice(e.destination.index,0,r);var a=A.a.clone(v),o=Object(s.a)({},a[e.source.index]);if(e.destination.index<e.source.index)Object.keys(a).filter((function(t){return parseInt(t,10)>=e.destination.index&&parseInt(t,10)<e.source.index})).reverse().forEach((function(e){a["".concat(parseInt(e,10)+1)]=a[e]})),a[e.destination.index]=o;else if(e.destination.index>e.source.index){Object.keys(a).filter((function(t){return parseInt(t,10)>=e.source.index&&parseInt(t,10)<=e.destination.index})).forEach((function(t){parseInt(t,10)===e.destination.index?a[e.destination.index]=o:a[t]=a["".concat(parseInt(t,10)+1)]}))}p(te(t)),p(ne(a))}}},a.a.createElement(Q.c,{droppableId:"droppable"},(function(e){return a.a.createElement("div",Object.assign({},e.droppableProps,{ref:e.innerRef,style:{background:"white"}}),g.map((function(e,t){return a.a.createElement(Q.b,{key:"searchField-".concat(t),draggableId:"searchField-".concat(t),index:t},(function(n,r){return a.a.createElement("div",Object.assign({ref:n.innerRef},n.draggableProps,n.dragHandleProps,{style:(o=r.isDragging,i=n.draggableProps.style,Object(s.a)({userSelect:"none",background:o?"#ededed":"white"},i))}),a.a.createElement($e,{key:"searchField-".concat(t),index:t,inputReference:S.current[t],addNewSearchFieldHandler:we,currentStops:g,removeSearchFieldHandler:Ce,searchStopsHandler:Re,singleStop:e,processHighlightedResultSelectHandler:Ne,onFieldFocusHandler:ke,onZoomRouteClick:l,onPanViaClick:u,isActiveRoute:c}));var o,i}))})),e.placeholder)}))),a.a.createElement("div",{className:"rd-mot-checkbox"},a.a.createElement(D.a,{className:d.checkbox,checked:L,onChange:function(){U(!L),null!==P&&Re({target:{value:S.current[P].current.value}},P)},color:"primary",inputProps:{"aria-label":"use only mot"}}),a.a.createElement("span",null,"Search only selected mode of transport"))),me?a.a.createElement($.a,null):null),a.a.createElement(je,{currentSearchResults:M,processClickedResultHandler:function(e){var t=g;t[ee]=e.properties.name;var n=A.a.clone(v);n[ee]=e,p(te(t)),V([]),Object.keys(n).forEach((function(e){var t;e===ee.toString()&&(n[e].geometry.coordinates=(t=n[e].geometry.coordinates,Object(F.m)(t,"EPSG:4326","EPSG:3857")))})),p(ne(n))}})):null}Qe.defaultProps={value:null,index:null},tt.defaultProps={onZoomRouteClick:void 0,onPanViaClick:void 0};var nt=tt,rt=n(243),at=n(168),ot=n(244),ct=n(205),it=function(e){return e.map((function(e){return new rt.b({stroke:new at.a({color:e[0],width:e[1],lineDash:e[2]})})}))},lt=it([["darkred",6],["red",3]]),ut=it([["darkred",7],["red",4]]),st=it([["rgb(153,153,0)",6],["yellow",3]]),dt=it([["rgb(153,153,0)",7],["yellow",4]]),pt=it([["rgb(96, 186, 219)",6],["rgb(173, 216, 230)",3]]),mt=it([["rgb(96, 186, 219)",7],["rgb(173, 216, 230)",4]]),ft=it([["grey",6],["darkgrey",3]]),ht=it([["grey",7],["darkgrey",4]]),bt=it([["darkblue",6],["blue",3]]),gt=it([["darkblue",7],["blue",4]]),vt=new rt.b({image:new ot.a({radius:7,fill:new ct.a({color:"red"}),stroke:new at.a({color:"darkred",width:2})})}),St=new rt.b({image:new ot.a({radius:3,fill:new ct.a({color:"rgb(173, 216, 230)"}),stroke:new at.a({color:"rgb(96, 186, 219)",width:2})})}),yt=new rt.b({image:new ot.a({radius:3,fill:new ct.a({color:"darkgrey"}),stroke:new at.a({color:"grey",width:2})})}),Et=new rt.b({image:new ot.a({radius:7,fill:new ct.a({color:"yellow"}),stroke:new at.a({color:"rgb(153,153,0)",width:2})})}),Ot=new rt.b({image:new ot.a({radius:7,fill:new ct.a({color:"blue"}),stroke:new at.a({color:"darkblue",width:2})})}),kt=function(e,t){return"rail"===e?t?ut:lt:"bus"===e?t?dt:st:"foot"===e?t?mt:pt:"car"===e?t?ht:ft:t?gt:bt},wt=(n(566),new AbortController),Ct=function(e){function t(e){var n;return Object(O.a)(this,t),(n=Object(w.a)(this,Object(C.a)(t).call(this,e))).drawNewRoute=function(){var e=[],t=n.props,r=t.currentStopsGeoJSON,a=t.routingUrl,o=t.currentMot,c=t.APIKey,i=t.onShowNotification;Object.keys(r).forEach((function(t){r[t].features?e.push("".concat(ge(r[t].features[0].geometry.coordinates).slice().reverse())):"rail"===o||"bus"===o?e.push("!".concat(r[t].properties.uid)):e.push("".concat(r[t].properties.name))})),wt.abort();var l=(wt=new AbortController).signal,u="".concat(a,"?via=").concat(e.join("|"),"&mot=").concat(o,"&resolve-hops=false&srs=3857&key=").concat(c);fetch(u,{signal:l}).then((function(e){return e.json()})).then((function(e){if(e.error)i("Couldn't find route","error");else{n.routeVectorSource.clear();var t=ue.includes(o)?new M.a({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}):new M.a;n.routeVectorSource.addFeatures(t.readFeatures(e)),n.setIsActiveRoute(!!n.routeVectorSource.getFeatures().length),n.routeVectorSource.getFeatures().forEach((function(e){return e.setStyle(kt(o))}))}})).catch((function(e){if("AbortError"!==e.name)throw e;console.warn("Abort ".concat(u))}))},n.hoveredFeature=null,n.hoveredRoute=null,n.state={hoveredStationOpen:!1,hoveredStationName:"",isActiveRoute:!1},n}return Object(j.a)(t,e),Object(k.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.APIKey,r=t.onSetClickLocation,a=[949042.143189,5899715.591163];this.markerVectorSource=new V.a({}),this.markerVectorLayer=new x.a({zIndex:1,source:this.markerVectorSource}),this.routeVectorSource=new V.a({}),this.routeVectorLayer=new x.a({zIndex:0,source:this.routeVectorSource});var o=new G.a({layers:[this.markerVectorLayer]});o.on("translateend",(function(t){var n,r=e.props,a=r.currentStops,o=r.currentStopsGeoJSON,c=r.onSetCurrentStops,i=r.onSetCurrentStopsGeoJSON,l=A.a.clone(a),u=A.a.clone(o),s=t.features.getArray()[0].getProperties(),d=s.name,p=s.id;l[n=d?a.indexOf(d):function(e,t){for(var n=0;n<e.length;n+=1)if(e[n][0]===t[0]&&e[n][1]===t[1])return n;return-1}(a,p.slice().reverse())]=t.coordinate,u[n]={type:"FeatureCollection",features:[{type:"Feature",properties:{id:t.coordinate.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:t.coordinate}}]},c(l),i(u)})),this.map=new R.a({target:"map",interactions:Object(H.a)().extend([o]),view:new N.a({projection:"EPSG:3857",center:a,zoom:6})});var c=new I.a.Map({style:"https://maps.geops.io/styles/travic/style.json?key=".concat(n),attributionControl:!1,boxZoom:!1,center:Object(F.j)(a),container:this.map.getTargetElement(),doubleClickZoom:!1,dragPan:!1,dragRotate:!1,interactive:!1,keyboard:!1,pitchWithRotate:!1,scrollZoom:!1,touchZoomRotate:!1}),i=new P.a({render:function(e){var t=c.getCanvas(),n=e.viewState,r=i.getVisible();t.style.display=r?"block":"none";var a=i.getOpacity();t.style.opacity=a;var o=n.rotation;return o&&c.rotateTo(180*-o/Math.PI,{animate:!1}),c.jumpTo({center:Object(F.j)(n.center),zoom:n.zoom-1,animate:!1}),c._frame&&(c._frame.cancel(),c._frame=null),c._render(),t}});[i,this.markerVectorLayer,this.routeVectorLayer].forEach((function(t){return e.map.addLayer(t)})),this.onZoomRouteClick=function(){var t;e.routeVectorSource.getFeatures().length&&(t=e.routeVectorSource.getExtent()),4===t.filter((function(e){return Number.isFinite(e)})).length&&e.map.getView().fit(e.routeVectorSource.getExtent(),{size:e.map.getSize(),duration:500,padding:[200,200,200,200]})},this.onPanViaClick=function(t,n){var r=e.props.currentStopsGeoJSON;if(r&&r[n]){var a=r[n].features?r[n].features[0].geometry.coordinates:r[n].geometry.coordinates;e.map.getView().animate({center:a,duration:500,padding:[100,100,100,100]})}},this.map.on("singleclick",(function(t){var n=e.props,a=n.isFieldFocused;(n.currentStops.includes("")||a)&&r(t.coordinate)})),this.map.on("pointermove",(function(t){var n=e.props.currentMot;e.hoveredFeature&&(e.hoveredFeature=null,e.setState({hoveredStationOpen:!1,hoveredStationName:""})),e.hoveredRoute&&(e.hoveredRoute.setStyle(kt(n,!1)),e.hoveredRoute=null);var r=e.map.getFeaturesAtPixel(t.pixel);r.length?document.body.classList.add("rd-pointer"):document.body.classList.contains("rd-pointer")&&document.body.classList.remove("rd-pointer"),r.forEach((function(t){if("Point"===t.getGeometry().getType()){e.hoveredFeature=t;var r="",a=t.get("country_code");r=t.get("name")?"".concat(t.get("name")).concat(a?" - ".concat(a):""):"".concat(ge(t.getGeometry().flatCoordinates)),e.setState({hoveredStationOpen:!0,hoveredStationName:r})}return"LineString"===t.getGeometry().getType()&&(e.hoveredRoute=t,t.setStyle(kt(n,!0))),!0}))}))}},{key:"componentDidUpdate",value:function(e){var t=this,n=this.props,r=n.currentStopsGeoJSON,a=n.currentMot,o=a&&a!==e.currentMot,c=r&&r!==e.currentStopsGeoJSON;(o||c)&&(this.markerVectorSource.clear(),Object.keys(r).forEach((function(e){t.markerVectorSource.addFeatures((new M.a).readFeatures(r[e])),t.markerVectorSource.getFeatures().forEach((function(e){return e.setStyle("rail"===(t=a)?vt:"bus"===t?Et:"foot"===t?St:"car"===t?yt:Ot);var t}))})),this.routeVectorSource.clear(),this.setIsActiveRoute(!1),Object.keys(r).length>1&&this.drawNewRoute())}},{key:"setIsActiveRoute",value:function(e){this.setState({isActiveRoute:e})}},{key:"render",value:function(){var e=this.props,t=e.mots,n=e.APIKey,r=e.stationSearchUrl,o=this.state,c=o.isActiveRoute,i=o.hoveredStationOpen,l=o.hoveredStationName;return a.a.createElement(a.a.Fragment,null,a.a.createElement(nt,{mots:t,stationSearchUrl:r,isActiveRoute:c,onZoomRouteClick:this.onZoomRouteClick,onPanViaClick:this.onPanViaClick,APIKey:n}),a.a.createElement(L.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:i,message:l}),a.a.createElement("div",{id:"map",className:"rd-map-comp"}))}}]),t}(r.Component);Ct.getExtentCenter=function(e){return[e[0]+(e[2]-e[0])/2,e[1]+(e[3]-e[1])/2]};var jt=Object(i.b)((function(e){return{currentMot:e.MapReducer.currentMot,currentStops:e.MapReducer.currentStops,currentStopsGeoJSON:e.MapReducer.currentStopsGeoJSON,isFieldFocused:e.MapReducer.isFieldFocused}}),(function(e){return{onSetCurrentStops:function(t){return e(te(t))},onSetCurrentStopsGeoJSON:function(t){return e(ne(t))},onSetClickLocation:function(t){return e(function(e){return{type:"SET_CLICK_LOCATION",clickLocation:e}}(t))},onShowNotification:function(t,n){return e(ae(t,n))}}}))(Ct),Rt=n(630),Nt=function(e){function t(e){var n;return Object(O.a)(this,t),(n=Object(w.a)(this,Object(C.a)(t).call(this,e))).handleOpen=function(){n.setState({open:!0})},n.handleClose=function(){var e=n.props.onShowNotification;n.setState({open:!1}),e(null,"error")},n.state={open:!1},n}return Object(j.a)(t,e),Object(k.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props.notificationMessage;t&&t!==e.notificationMessage&&this.handleOpen()}},{key:"render",value:function(){var e=this.props,t=e.notificationMessage,n=e.notificationType,r=this.state.open;return a.a.createElement(L.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:r,autoHideDuration:6e3,onClose:this.handleClose},a.a.createElement(Rt.a,{onClose:this.handleClose,severity:n,elevation:6,variant:"filled"},t))}}]),t}(a.a.Component),Ft=Object(i.b)((function(e){return{notificationMessage:e.MapReducer.notificationMessage,notificationType:e.MapReducer.notificationType}}),(function(e){return{onShowNotification:function(t,n){return e(ae(t,n))}}}))(Nt),xt={mots:le,routingUrl:"https://api.geops.io/routing/dev/",stationSearchUrl:"https://api.geops.io/stops/dev/"};function Pt(e){var t=e.mots,n=e.routingUrl,r=e.stationSearchUrl;return a.a.createElement(i.a,{store:E},a.a.createElement(jt,{mots:t,routingUrl:n,APIKey:"5cc87b12d7c5370001c1d655012b7edc8da1475084e49b84b6ba658e",stationSearchUrl:r}),a.a.createElement(Ft,null))}Pt.defaultProps=xt;var Tt=Pt;n(568),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(Tt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[354,1,2]]]);
//# sourceMappingURL=main.f49d34ce.chunk.js.map