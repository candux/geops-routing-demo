(this["webpackJsonpgeops-routing-demo"]=this["webpackJsonpgeops-routing-demo"]||[]).push([[0],{180:function(e,t,a){e.exports=a(213)},185:function(e,t,a){},209:function(e,t,a){},211:function(e,t,a){},213:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(27),c=a.n(o),s=(a(185),a(89)),u=a(83),l=a(140),i=a(97),p={currentMot:"bus",currentStopsGeoJSON:{}},m=function(e,t){var a={currentStopsGeoJSON:t.currentStopsGeoJSON};return Object(i.a)({},e,{},a)},d=function(e,t){var a={currentMot:t.currentMot};return Object(i.a)({},e,{},a)},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CURRENT_STOPS_GEOJSON":return m(e,t);case"SET_CURRENT_MOT":return d(e,t);default:return e}},h=u.d,f=Object(u.c)({MapReducer:S}),v=Object(u.e)(f,h(Object(u.a)(l.a))),g=a(100),E=a(101),y=a(118),O=a(102),b=a(121),w=a(258),R=a(155),N=a(262),C=a(265),k=a(154),M=a(124),G=a(264),J=a(91),j=a.n(J),F=(a(209),a(125)),T=a(98),x=a(266),B=function(e){function t(e){var a;return Object(g.a)(this,t),(a=Object(y.a)(this,Object(O.a)(t).call(this,e))).drawNewRoute=function(){a.findRouteCancel&&a.findRouteCancel();var e=[];for(var t in a.props.currentStopsGeoJSON)e.push("!"+a.props.currentStopsGeoJSON[t].properties.id);j.a.get(a.props.routingUrl,{params:{via:e.join("|"),mot:a.props.currentMot,key:a.props.APIKey},cancelToken:new a.findRouteCancelToken((function(e){a.findRouteCancel=e}))}).then((function(e){var t=new G.a({features:(new M.a).readFeatures(e.data)}),n=new N.a({source:t,style:a.routeStyle});n.set("type","route"),a.map.addLayer(n),a.map.getView().fit(t.getExtent(),{size:a.map.getSize(),duration:500})}),(function(e){console.log(e)}))},a.removeCurrentRoute=function(){a.map.getLayers().forEach((function(e){e&&"route"===e.get("type")&&a.map.removeLayer(e)}))},a.findRouteCancelToken=j.a.CancelToken,a.findRouteCancel=null,a.routeStyle=new F.b({stroke:new T.a({color:"blue",lineDash:[4],width:3})}),a}return Object(b.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=new C.a({source:new k.a});this.map=new w.a({target:"map",layers:[e],view:new R.a({projection:"EPSG:4326",center:[10,50],zoom:6})})}},{key:"componentDidUpdate",value:function(e){var t=this;if(this.props.currentStopsGeoJSON&&this.props.currentStopsGeoJSON!==e.currentStopsGeoJSON){for(var a in this.map.getLayers().forEach((function(e){e&&"markers"===e.get("type")&&t.map.removeLayer(e)})),this.props.currentStopsGeoJSON){var n=new G.a({features:(new M.a).readFeatures(this.props.currentStopsGeoJSON[a])}),r=new N.a({source:n,style:new F.b({image:new x.a({crossOrigin:"anonymous",src:"img/map-marker.png"})})});r.set("type","markers"),this.map.addLayer(r);var o=n.getFeatures()[0].getGeometry().getCoordinates();this.map.getView().animate({center:o,duration:500})}Object.keys(this.props.currentStopsGeoJSON).length>1?this.drawNewRoute():this.removeCurrentRoute()}}},{key:"render",value:function(){return r.a.createElement("div",{id:"map",className:"MapComponent"})}}]),t}(n.Component),L=Object(s.b)((function(e){return{currentMot:e.MapReducer.currentMot,currentStopsGeoJSON:e.MapReducer.currentStopsGeoJSON}}))(B),I=a(156),_=a(253),U=a(263),H=a(254),P=a(252),z=a(260),A=a(259),D=a(257),K=a(152),q=a.n(K),V=a(150),W=a.n(V),$=a(123),Q=a.n($),X=a(153),Y=a.n(X),Z=a(149),ee=a.n(Z),te=a(151),ae=a.n(te),ne=(a(211),a(255)),re=a(256),oe=a(141),ce=a.n(oe),se=a(142),ue=a.n(se),le=a(143),ie=a.n(le),pe=a(144),me=a.n(pe),de=a(145),Se=a.n(de),he=a(146),fe=a.n(he),ve=a(147),ge=a.n(ve),Ee=a(148),ye=a.n(Ee),Oe=[{name:"bus",icon:r.a.createElement(ce.a,null)},{name:"ferry",icon:r.a.createElement(ue.a,null)},{name:"gondola",icon:r.a.createElement(ie.a,null)},{name:"tram",icon:r.a.createElement(me.a,null)},{name:"rail",icon:r.a.createElement(Se.a,null)},{name:"funicular",icon:r.a.createElement(fe.a,null)},{name:"cable_car",icon:r.a.createElement(ge.a,null)},{name:"subway",icon:r.a.createElement(ye.a,null)}];function be(e){var t=e.children,a=e.value,n=e.index,o=Object(I.a)(e,["children","value","index"]);return r.a.createElement(P.a,Object.assign({component:"div",role:"tabpanel",hidden:a!==n,id:"simple-tabpanel-".concat(n),"aria-labelledby":"simple-tab-".concat(n)},o),a===n&&r.a.createElement(z.a,{p:3},t))}var we=function(e){function t(e){var a;Object(g.a)(this,t),(a=Object(y.a)(this,Object(O.a)(t).call(this,e))).validateMots=function(e){var t=[];return e.forEach((function(e){var a=Oe.find((function(t){return t.name===e}));a&&t.push(a)})),0===t.length&&t.push(Oe[0]),t},a.handleMotChange=function(e,t){a.setState({currentMot:t}),a.props.onSetCurrentMot(t)},a.onFieldFocus=function(e){a.setState({focusedFieldIndex:e})},a.onFieldBlur=function(){a.setState({focusedFieldIndex:null})},a.searchStops=function(e,t){if(!e.target.value){var n=a.state.currentStops;return n[t]="",void a.setState({currentSearchResults:[],currentStops:n,showLoadingBar:!1})}var r=a.state.currentStops;r[t]=e.target.value,a.setState({currentStops:r,showLoadingBar:!0}),a.searchCancel&&a.searchCancel(),j.a.get(a.props.stationSearchUrl,{params:{q:e.target.value,key:a.props.APIKey},cancelToken:new a.searchCancelToken((function(e){a.searchCancel=e}))}).then((function(e){var t=[];e.data.features.forEach((function(e){e.properties.mot[a.state.currentMot]&&t.push(e)})),a.setState({currentSearchResults:t,showLoadingBar:!1})}),(function(e){console.log(e),a.setState({showLoadingBar:!1})}))},a.processHighlightedResultSelect=function(e){if("Enter"===e.key&&a.state.currentSearchResults[0]){var t=a.state.currentStops;t[a.state.focusedFieldIndex]=a.state.currentSearchResults[0].properties.name;var n=Object(i.a)({},a.state.currentStopsGeoJSON);n[a.state.focusedFieldIndex]=a.state.currentSearchResults[0],a.setState({currentStops:t,currentSearchResults:[],currentStopsGeoJSON:n}),a.props.onSetCurrentStopsGeoJSON(n)}if("Backspace"===e.key){var r=[];e.target.value&&(r=a.state.currentSearchResults);var o={};for(var c in a.state.currentStopsGeoJSON)c!==a.state.focusedFieldIndex.toString()&&(o[c]=a.state.currentStopsGeoJSON[c]);a.setState({currentStopsGeoJSON:o,currentSearchResults:r}),a.props.onSetCurrentStopsGeoJSON(o)}},a.processRoute=function(){a.props.onFindRoute(a.state.currentStopsGeoJSON,a.state.currentMot)};var n=a.validateMots(e.mots);return a.state={currentMots:n,currentMot:n[0].name,currentSearchResults:[],focusedFieldIndex:null,currentStops:["",""],currentStopsGeoJSON:{},showLoadingBar:!1},a.searchCancelToken=j.a.CancelToken,a.searchCancel=null,a.props.onSetCurrentMot(n[0].name),a}return Object(b.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this,t=this.state.currentStops.filter((function(e){return""!==e})).length>1;return r.a.createElement("div",{className:"RoutingMenu"},r.a.createElement(_.a,{square:!0,elevation:3},r.a.createElement(U.a,{value:this.state.currentMot,onChange:this.handleMotChange,variant:"scrollable",scrollButtons:"auto",indicatorColor:"primary",textColor:"primary","aria-label":"icon tabs example"},this.state.currentMots.map((function(e){return r.a.createElement(H.a,{key:"mot-"+e.name,value:e.name,icon:e.icon,"aria-label":e.name})}))),r.a.createElement(be,null,this.state.currentStops.map((function(a,n){var o=null,c=10,s="",u=null;return 0===n?(o=r.a.createElement(ee.a,{fontSize:"small",color:"secondary"}),s="Select start station, or click on the map",u=r.a.createElement(ne.a,{item:!0,xs:1},r.a.createElement(re.a,{className:"addHop",color:"primary","aria-label":"Add Hop",component:"span"},r.a.createElement(Q.a,null)))):n===e.state.currentStops.length-1?(o=r.a.createElement(W.a,{color:"secondary"}),s="Select end station, or click on the map",u=r.a.createElement(ne.a,{item:!0,xs:1},r.a.createElement(re.a,{disabled:!t,className:"addHop",color:"primary","aria-label":"Find Route",onClick:e.processRoute,component:"span"},r.a.createElement(ae.a,null)))):(o=r.a.createElement(q.a,{fontSize:"small",color:"secondary"}),c=9,s="Select station, or click on the map",u=r.a.createElement(r.a.Fragment,null,r.a.createElement(ne.a,{item:!0,xs:1},r.a.createElement(re.a,{className:"addHop",color:"secondary","aria-label":"upload picture",component:"span"},r.a.createElement(Y.a,null))),r.a.createElement(ne.a,{item:!0,xs:1},r.a.createElement(re.a,{className:"addHop",color:"primary","aria-label":"upload picture",component:"span"},r.a.createElement(Q.a,null))))),r.a.createElement(ne.a,{key:"searchField-"+n,container:!0,spacing:1,alignItems:"flex-end",style:{width:"100%"}},r.a.createElement(ne.a,{item:!0,xs:1},o),r.a.createElement(ne.a,{item:!0,xs:c},r.a.createElement(A.a,{style:{width:"100%"},label:s,color:"secondary",onChange:function(t){return e.searchStops(t,n)},value:a,onKeyDown:e.processHighlightedResultSelect,onFocus:function(){return e.onFieldFocus(n)},onBlur:e.onFieldBlur})),u)}))),this.state.showLoadingBar?r.a.createElement(D.a,null):null),0!==this.state.currentSearchResults.length?r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement(_.a,{square:!0,elevation:1},r.a.createElement(be,null,this.state.currentSearchResults.map((function(e,t){return 0!==t?r.a.createElement(P.a,{key:"searchResult-"+e.properties.name,variant:"subtitle1",gutterBottom:!0},e.properties.name):r.a.createElement(P.a,{key:"searchResult-"+e.properties.name,variant:"h6",gutterBottom:!0},e.properties.name)}))))):null)}}]),t}(r.a.Component),Re=Object(s.b)(null,(function(e){return{onSetCurrentMot:function(t){return e(function(e){return{type:"SET_CURRENT_MOT",currentMot:e}}(t))},onSetCurrentStopsGeoJSON:function(t){return e(function(e){return{type:"SET_CURRENT_STOPS_GEOJSON",currentStopsGeoJSON:e}}(t))}}}))(we);var Ne=function(e){return r.a.createElement(s.a,{store:v},r.a.createElement(Re,e),r.a.createElement(L,e))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ce=r.a.createElement(Ne,{mots:["rail","bus","tram"],routingUrl:"https://api.geops.io/routing/v1/",stationSearchUrl:"https://api.geops.io/stops/v1/",APIKey:"5cc87b12d7c5370001c1d655d0a18192eba64838a5fa1ad7d482ab82"});c.a.render(Ce,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[180,1,2]]]);
//# sourceMappingURL=main.8afc33bc.chunk.js.map