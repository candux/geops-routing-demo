(this["webpackJsonpgeops-routing-demo"]=this["webpackJsonpgeops-routing-demo"]||[]).push([[0],{192:function(e,t,n){e.exports=n(224)},197:function(e,t,n){},220:function(e,t,n){},222:function(e,t,n){},224:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(24),c=n.n(o),s=(n(197),n(76)),i=n(86),u=n(150),l=n(72),p={currentMot:"bus",currentStopsGeoJSON:{},clickLocation:null,notificationMessage:"",notificationType:"info"},d=function(e,t){var n={currentStopsGeoJSON:t.currentStopsGeoJSON};return Object(l.a)({},e,{},n)},S=function(e,t){var n={currentMot:t.currentMot};return Object(l.a)({},e,{},n)},m=function(e,t){var n={clickLocation:t.clickLocation};return Object(l.a)({},e,{},n)},h=function(e,t){var n={notificationMessage:t.notificationMessage,notificationType:t.notificationType};return Object(l.a)({},e,{},n)},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CURRENT_STOPS_GEOJSON":return d(e,t);case"SET_CURRENT_MOT":return S(e,t);case"SET_CLICK_LOCATION":return m(e,t);case"SHOW_NOTIFICATION":return h(e,t);default:return e}},v=i.d,g=Object(i.c)({MapReducer:f}),O=Object(i.e)(g,v(Object(i.a)(u.a))),E=n(91),y=n(92),b=n(97),C=n(93),N=n(98),k=n(280),w=n(165),R=n(284),M=n(288),G=n(164),J=n(133),T=n(287),j=n(87),F=n.n(j),L=(n(220),n(134)),I=n(107),_=function(e){return{type:"SET_CLICK_LOCATION",clickLocation:e}},x=function(e,t){return{type:"SHOW_NOTIFICATION",notificationMessage:e,notificationType:t}},H=function(e){function t(e){var n;return Object(E.a)(this,t),(n=Object(b.a)(this,Object(C.a)(t).call(this,e))).drawNewRoute=function(){n.findRouteCancel&&n.findRouteCancel();var e=[];for(var t in n.props.currentStopsGeoJSON)n.props.currentStopsGeoJSON[t].features?e.push("@"+n.props.currentStopsGeoJSON[t].features[0].properties.id):e.push("!"+n.props.currentStopsGeoJSON[t].properties.id);F.a.get(n.props.routingUrl,{params:{via:e.join("|"),mot:n.props.currentMot,key:n.props.APIKey},cancelToken:new n.findRouteCancelToken((function(e){n.findRouteCancel=e}))}).then((function(e){var t=new T.a({features:(new J.a).readFeatures(e.data)}),a=new R.a({source:t,style:n.routeStyle});a.set("type","route"),n.map.addLayer(a),n.map.getView().fit(t.getExtent(),{size:n.map.getSize(),duration:500})}),(function(e){console.log(e),n.props.onShowNotification("Couldn't find route","error")}))},n.removeCurrentRoute=function(){n.map.getLayers().forEach((function(e){e&&"route"===e.get("type")&&n.map.removeLayer(e)}))},n.findRouteCancelToken=F.a.CancelToken,n.findRouteCancel=null,n.routeStyle=new L.b({stroke:new I.a({color:"red",width:3})}),n}return Object(N.a)(t,e),Object(y.a)(t,[{key:"componentDidMount",value:function(){var e=this,t="".concat("geops-routing-demo"," v-").concat("0.4.1"),n=new M.a({source:new G.a({attributions:'<a href="https://geops.ch/" target="_blank">geOps</a> | <a href="https://ibrahimawadhamid.github.io/geops-routing-demo" target="_blank">'+t+'</a> | <a href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer" target="_blank">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"})});this.map=new k.a({target:"map",layers:[n],view:new w.a({projection:"EPSG:4326",center:[10,50],zoom:6})}),this.map.on("singleclick",(function(t){e.props.onSetClickLocation(t.coordinate)}))}},{key:"componentDidUpdate",value:function(e){var t=this;if(this.props.currentStopsGeoJSON&&this.props.currentStopsGeoJSON!==e.currentStopsGeoJSON){for(var n in this.map.getLayers().forEach((function(e){e&&"markers"===e.get("type")&&t.map.removeLayer(e)})),this.props.currentStopsGeoJSON){var a=new T.a({features:(new J.a).readFeatures(this.props.currentStopsGeoJSON[n])}),r=new R.a({source:a});r.set("type","markers"),this.map.addLayer(r);var o=a.getFeatures()[0].getGeometry().getCoordinates();this.map.getView().animate({center:o,duration:500})}Object.keys(this.props.currentStopsGeoJSON).length>1?this.drawNewRoute():this.removeCurrentRoute()}}},{key:"render",value:function(){return r.a.createElement("div",{id:"map",className:"MapComponent"})}}]),t}(a.Component),A=Object(s.b)((function(e){return{currentMot:e.MapReducer.currentMot,currentStopsGeoJSON:e.MapReducer.currentStopsGeoJSON}}),(function(e){return{onSetClickLocation:function(t){return e(_(t))},onShowNotification:function(t,n){return e(x(t,n))}}}))(H),B=n(166),U=n(270),z=n(285),P=n(271),D=n(126),K=n(282),W=n(281),q=n(276),V=n(162),$=n.n(V),Q=n(161),X=n.n(Q),Y=n(131),Z=n.n(Y),ee=n(163),te=n.n(ee),ne=n(159),ae=n.n(ne),re=n(275),oe=n(277),ce=n(278),se=n(279),ie=n(132),ue=n.n(ie),le=n(291),pe=(n(222),n(272)),de=n(274),Se=n(151),me=n.n(Se),he=n(152),fe=n.n(he),ve=n(153),ge=n.n(ve),Oe=n(154),Ee=n.n(Oe),ye=n(155),be=n.n(ye),Ce=n(156),Ne=n.n(Ce),ke=n(157),we=n.n(ke),Re=n(158),Me=n.n(Re),Ge=[{name:"bus",icon:r.a.createElement(me.a,null)},{name:"ferry",icon:r.a.createElement(fe.a,null)},{name:"gondola",icon:r.a.createElement(ge.a,null)},{name:"tram",icon:r.a.createElement(Ee.a,null)},{name:"rail",icon:r.a.createElement(be.a,null)},{name:"funicular",icon:r.a.createElement(Ne.a,null)},{name:"cable_car",icon:r.a.createElement(we.a,null)},{name:"subway",icon:r.a.createElement(Me.a,null)}];function Je(e){var t=e.children,n=e.value,a=e.index,o=Object(B.a)(e,["children","value","index"]);return r.a.createElement(D.a,Object.assign({component:"div",role:"tabpanel",hidden:n!==a,id:"simple-tabpanel-".concat(a),"aria-labelledby":"simple-tab-".concat(a)},o),n===a&&r.a.createElement(K.a,{p:3},t))}var Te=function(e){function t(e){var n;Object(E.a)(this,t),(n=Object(b.a)(this,Object(C.a)(t).call(this,e))).validateMots=function(e){var t=[];return e.forEach((function(e){var n=Ge.find((function(t){return t.name===e}));n&&t.push(n)})),0===t.length&&t.push(Ge[0]),t},n.handleMotChange=function(e,t){n.setState({currentMot:t}),n.props.onSetCurrentMot(t)},n.onFieldFocus=function(e){n.setState({focusedFieldIndex:e})},n.onFieldBlur=function(){},n.addNewSearchField=function(e){var t=n.state.currentStops;t.splice(e,0,""),n.setState({currentStops:t})},n.removeSearchField=function(e){var t=n.state.currentStops;t.splice(e,1);var a={};for(var r in n.state.currentStopsGeoJSON)r!==e.toString()&&(a[r]=n.state.currentStopsGeoJSON[r]);n.setState({currentStops:t,currentStopsGeoJSON:a}),n.props.onSetCurrentStopsGeoJSON(a)},n.searchStops=function(e,t){if(!e.target.value){var a=n.state.currentStops;return a[t]="",void n.setState({currentSearchResults:[],currentStops:a,showLoadingBar:!1})}var r=n.state.currentStops;r[t]=e.target.value,n.setState({currentStops:r,showLoadingBar:!0}),n.searchCancel&&n.searchCancel(),F.a.get(n.props.stationSearchUrl,{params:{q:e.target.value,key:n.props.APIKey},cancelToken:new n.searchCancelToken((function(e){n.searchCancel=e}))}).then((function(e){0===e.data.features.length&&n.props.onShowNotification("Couldn't find stations","warning");var t=[];e.data.features.forEach((function(e){e.properties.mot[n.state.currentMot]&&t.push(e)})),n.setState({currentSearchResults:t,showLoadingBar:!1})}),(function(e){console.log(e),n.setState({showLoadingBar:!1}),F.a.isCancel(e)||n.props.onShowNotification("Error while searching for stations","error")}))},n.processHighlightedResultSelect=function(e){if("Enter"===e.key&&n.state.currentSearchResults[0]){var t=n.state.currentStops;t[n.state.focusedFieldIndex]=n.state.currentSearchResults[0].properties.name;var a=Object(l.a)({},n.state.currentStopsGeoJSON);a[n.state.focusedFieldIndex]=n.state.currentSearchResults[0],n.setState({currentStops:t,currentSearchResults:[],currentStopsGeoJSON:a}),n.props.onSetCurrentStopsGeoJSON(a)}if("Backspace"===e.key){var r=[];e.target.value&&(r=n.state.currentSearchResults);var o={};for(var c in n.state.currentStopsGeoJSON)c!==n.state.focusedFieldIndex.toString()&&(o[c]=n.state.currentStopsGeoJSON[c]);n.setState({currentStopsGeoJSON:o,currentSearchResults:r}),n.props.onSetCurrentStopsGeoJSON(o)}},n.processClickedResult=function(e){var t=n.state.currentStops;t[n.state.focusedFieldIndex]=e.properties.name;var a=Object(l.a)({},n.state.currentStopsGeoJSON);a[n.state.focusedFieldIndex]=e,n.setState({currentStops:t,currentSearchResults:[],currentStopsGeoJSON:a}),n.props.onSetCurrentStopsGeoJSON(a)},n.processRoute=function(){n.props.onFindRoute(n.state.currentStopsGeoJSON,n.state.currentMot)};var a=n.validateMots(e.mots);return n.state={currentMots:a,currentMot:a[0].name,currentSearchResults:[],focusedFieldIndex:null,currentStops:["",""],currentStopsGeoJSON:{},showLoadingBar:!1},n.searchCancelToken=F.a.CancelToken,n.searchCancel=null,n.props.onSetCurrentMot(a[0].name),n}return Object(N.a)(t,e),Object(y.a)(t,[{key:"componentDidUpdate",value:function(e){if(this.props.clickLocation&&this.props.clickLocation!==e.clickLocation){var t=this.state.currentStops;t[this.state.focusedFieldIndex]=this.props.clickLocation;var n=Object(l.a)({},this.state.currentStopsGeoJSON),a={type:"FeatureCollection",features:[{type:"Feature",properties:{id:this.props.clickLocation.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:this.props.clickLocation}}]};n[this.state.focusedFieldIndex]=a,this.setState({currentStops:t,currentStopsGeoJSON:n}),this.props.onSetCurrentStopsGeoJSON(n)}}},{key:"render",value:function(){var e=this;this.state.currentStops.filter((function(e){return""!==e})).length;return r.a.createElement("div",{className:"RoutingMenu"},r.a.createElement(U.a,{square:!0,elevation:3},r.a.createElement(z.a,{value:this.state.currentMot,onChange:this.handleMotChange,variant:"scrollable",scrollButtons:"auto",indicatorColor:"primary",textColor:"primary","aria-label":"icon tabs example"},this.state.currentMots.map((function(e){return r.a.createElement(P.a,{key:"mot-"+e.name,value:e.name,icon:e.icon,"aria-label":e.name})}))),r.a.createElement(Je,null,this.state.currentStops.map((function(t,n){var a=null,o=10,c="",s=null;return 0===n?(a=r.a.createElement(ae.a,{fontSize:"small",color:"secondary"}),c="Select start station, or click on the map",s=r.a.createElement(pe.a,{item:!0,xs:1},r.a.createElement(le.a,{title:"Add Hop"},r.a.createElement(de.a,{onClick:function(){return e.addNewSearchField(n+1)},className:"addHop",color:"primary","aria-label":"Add Hop",component:"span"},r.a.createElement(Z.a,null))))):n===e.state.currentStops.length-1?(a=r.a.createElement(X.a,{color:"secondary"}),c="Select end station, or click on the map"):(a=r.a.createElement($.a,{fontSize:"small",color:"secondary"}),o=9,c="Select station, or click on the map",s=r.a.createElement(r.a.Fragment,null,r.a.createElement(pe.a,{item:!0,xs:1},r.a.createElement(le.a,{title:"Remove Hop"},r.a.createElement(de.a,{onClick:function(){return e.removeSearchField(n)},className:"addHop",color:"secondary","aria-label":"removeHop",component:"span"},r.a.createElement(te.a,null)))),r.a.createElement(pe.a,{item:!0,xs:1},r.a.createElement(le.a,{title:"Add Hop"},r.a.createElement(de.a,{onClick:function(){return e.addNewSearchField(n+1)},className:"addHop",color:"primary","aria-label":"addHop",component:"span"},r.a.createElement(Z.a,null)))))),r.a.createElement(pe.a,{key:"searchField-"+n,container:!0,spacing:1,alignItems:"flex-end",style:{width:"100%"}},r.a.createElement(pe.a,{item:!0,xs:1},a),r.a.createElement(pe.a,{item:!0,xs:o},r.a.createElement(W.a,{style:{width:"100%"},label:c,color:"secondary",onChange:function(t){return e.searchStops(t,n)},value:t,onKeyDown:e.processHighlightedResultSelect,onFocus:function(){return e.onFieldFocus(n)},onBlur:e.onFieldBlur})),s)}))),this.state.showLoadingBar?r.a.createElement(q.a,null):null),0!==this.state.currentSearchResults.length?r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement(U.a,{square:!0,elevation:1},r.a.createElement(Je,null,r.a.createElement(re.a,{component:"nav","aria-label":"search results"},this.state.currentSearchResults.map((function(t,n){return 0!==n?r.a.createElement(oe.a,{onClick:function(){return e.processClickedResult(t)},button:!0,key:"searchResult-"+t.properties.name},r.a.createElement(ce.a,null,r.a.createElement(ue.a,null)),r.a.createElement(se.a,{primary:t.properties.name,secondary:t.properties.code+" - "+t.properties.country_code})):r.a.createElement(oe.a,{onClick:function(){return e.processClickedResult(t)},button:!0,selected:!0,key:"searchResult-"+t.properties.name},r.a.createElement(ce.a,null,r.a.createElement(ue.a,null)),r.a.createElement(se.a,{primary:t.properties.name,secondary:t.properties.code+" - "+t.properties.country_code}))})))))):null)}}]),t}(r.a.Component),je=Object(s.b)((function(e){return{clickLocation:e.MapReducer.clickLocation}}),(function(e){return{onSetCurrentMot:function(t){return e(function(e){return{type:"SET_CURRENT_MOT",currentMot:e}}(t))},onSetCurrentStopsGeoJSON:function(t){return e(function(e){return{type:"SET_CURRENT_STOPS_GEOJSON",currentStopsGeoJSON:e}}(t))},onSetClickLocation:function(t){return e(_(t))},onShowNotification:function(t,n){return e(x(t,n))}}}))(Te),Fe=n(290),Le=n(286);function Ie(e){return r.a.createElement(Le.a,Object.assign({elevation:6,variant:"filled"},e))}var _e=function(e){function t(e){var n;return Object(E.a)(this,t),(n=Object(b.a)(this,Object(C.a)(t).call(this,e))).handleClose=function(){n.setState({open:!1})},n.state={open:!1},n}return Object(N.a)(t,e),Object(y.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.notificationMessage&&this.props.notificationMessage!==e.notificationMessage&&this.setState({open:!0})}},{key:"render",value:function(){return r.a.createElement(Fe.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:this.state.open,autoHideDuration:6e3,onClose:this.handleClose},r.a.createElement(Ie,{onClose:this.handleClose,severity:this.props.notificationType},this.props.notificationMessage))}}]),t}(r.a.Component),xe=Object(s.b)((function(e){return{notificationMessage:e.MapReducer.notificationMessage,notificationType:e.MapReducer.notificationType}}))(_e);var He=function(e){return r.a.createElement(s.a,{store:O},r.a.createElement(je,e),r.a.createElement(A,e),r.a.createElement(xe,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ae=r.a.createElement(He,{mots:["rail","bus","tram"],routingUrl:"https://api.geops.io/routing/v1/",stationSearchUrl:"https://api.geops.io/stops/v1/",APIKey:"5cc87b12d7c5370001c1d655d0a18192eba64838a5fa1ad7d482ab82"});c.a.render(Ae,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[192,1,2]]]);
//# sourceMappingURL=main.e337be4b.chunk.js.map