(this["webpackJsonpgeops-routing-demo"]=this["webpackJsonpgeops-routing-demo"]||[]).push([[0],{373:function(e,t,r){e.exports=r(588)},584:function(e,t,r){},586:function(e,t,r){},587:function(e,t,r){},588:function(e,t,r){"use strict";r.r(t);r(374),r(383),r(573);var n=r(0),a=r.n(n),o=r(26),c=r.n(o),i=r(58),u=r(88),l=r(333),s=r(106),d={currentMot:"bus",currentStops:["",""],currentStopsGeoJSON:{},clickLocation:null,notificationMessage:"",notificationType:"info",isFieldFocused:!1,showLoadingBar:!1},p=function(e,t){var r={currentStops:t.currentStops};return Object(s.a)({},e,{},r)},f=function(e,t){var r={currentStopsGeoJSON:t.currentStopsGeoJSON};return Object(s.a)({},e,{},r)},m=function(e,t){var r={currentMot:t.currentMot};return Object(s.a)({},e,{},r)},h=function(e,t){var r={clickLocation:t.clickLocation};return Object(s.a)({},e,{},r)},g=function(e,t){var r={notificationMessage:t.notificationMessage,notificationType:t.notificationType};return Object(s.a)({},e,{},r)},S=function(e,t){var r={isFieldFocused:t.isFieldFocused};return Object(s.a)({},e,{},r)},b=function(e,t){var r={showLoadingBar:t.showLoadingBar};return Object(s.a)({},e,{},r)},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CURRENT_STOPS":return p(e,t);case"SET_CURRENT_STOPS_GEOJSON":return f(e,t);case"SET_CURRENT_MOT":return m(e,t);case"SET_CLICK_LOCATION":return h(e,t);case"SHOW_NOTIFICATION":return g(e,t);case"SET_IS_FIELD_FOCUSED":return S(e,t);case"SET_SHOW_LOADING_BAR":return b(e,t);default:return e}},v=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||u.d,E=Object(u.c)({MapReducer:y}),O=Object(u.e)(E,v(Object(u.a)(l.a))),w=r(78),k=r(151),C=r(111),j=r(199),R=r(200),N=r(221),x=r(346),F=r(335),I=r(79),L=r(347),P=r(259),T=r(217),A=r(64),_=r.n(A),M=r(130),G=r(218),V=r(330),H=r(331),z=r(156),U=r(651),D=r(63),J=r(635),B=r(631),W=r(648),q=r(646),K=r(642),Z=r(643),X=r(645),$=r(641),Q=r(224),Y=r(644),ee=r(223),te=r(213),re=r.n(te),ne=function(e){return{type:"SET_CURRENT_STOPS",currentStops:e}},ae=function(e){return{type:"SET_CURRENT_STOPS_GEOJSON",currentStopsGeoJSON:e}},oe=function(e){return{type:"SET_CURRENT_MOT",currentMot:e}},ce=function(e,t){return{type:"SHOW_NOTIFICATION",notificationMessage:e,notificationType:t}},ie=function(e){return{type:"SET_IS_FIELD_FOCUSED",isFieldFocused:e}},ue=function(e){return{type:"SET_SHOW_LOADING_BAR",showLoadingBar:e}},le=(r(584),["rail","bus","foot"]),se=["tram","subway","gondola","funicular","ferry","car"],de=[].concat(le,se),pe=["foot","car"],fe=r(339),me=r.n(fe),he=r(337),ge=r.n(he),Se=r(338),be=r.n(Se),ye=r(7),ve=function(e){var t=null,r=e.charAt(0).toUpperCase()+e.slice(1);switch(e){case"rail":t=a.a.createElement(ge.a,null);break;case"foot":t=a.a.createElement(be.a,null);break;default:t=a.a.createElement(me.a,null)}return a.a.createElement("span",{title:r},t)},Ee=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;return Object(ye.n)(e,"EPSG:3857","EPSG:4326").map((function(e){return e.toFixed(t)}))},Oe=r(632),we=r(589),ke=r(634),Ce=r(633),je=r(257),Re=r.n(je),Ne=function(e,t){return e&&t?"".concat(e," - ").concat(t):e||t?e||t:null};function xe(e){var t=e.currentSearchResults,r=e.processClickedResultHandler;return 0===t.length?null:a.a.createElement(B.a,{square:!0,elevation:3},a.a.createElement(Oe.a,{component:"nav","aria-label":"search results"},t.map((function(e,t){return 0!==t?a.a.createElement(we.a,{onClick:function(){r(e)},button:!0,key:re()()},a.a.createElement(Ce.a,null,a.a.createElement(Re.a,null)),a.a.createElement(ke.a,{primary:e.properties.name,secondary:Ne(e.properties.code,e.properties.country_code)})):a.a.createElement(we.a,{onClick:function(){return r(e)},button:!0,selected:!0,key:"searchResult-".concat(e.properties.name)},a.a.createElement(Ce.a,null,a.a.createElement(Re.a,null)),a.a.createElement(ke.a,{primary:e.properties.name,secondary:Ne(e.properties.code,e.properties.country_code)}))}))))}xe.defaultProps={currentSearchResults:[]};var Fe=xe,Ie=r(638),Le=r(650),Pe=r(637),Te=r(652),Ae=r(344),_e=r.n(Ae),Me=r(342),Ge=r.n(Me),Ve=r(258),He=r.n(Ve),ze=r(345),Ue=r.n(ze),De=r(341),Je=r.n(De),Be=r(343),We=r.n(Be),qe=r(5),Ke=r.n(qe),Ze=Ke.a.arrayOf(Ke.a.number.isRequired).isRequired,Xe=Ke.a.shape({coordinates:Ze,type:Ke.a.string.isRequired}),$e=Ke.a.shape({geometry:Xe,properties:Ke.a.shape({id:Ke.a.oneOfType([Ke.a.string.isRequired,Ke.a.string.isRequired]),type:Ke.a.string.isRequired}),type:Ke.a.string.isRequired}),Qe=Ke.a.shape({features:Ke.a.shape({0:Ke.a.oneOfType([$e,Ze]),1:Ke.a.oneOfType([$e,Ze])}),type:Ke.a.string.isRequired}),Ye=(Ke.a.shape({0:Qe,1:Qe}),Ke.a.arrayOf(Ke.a.oneOfType([Ke.a.string.isRequired,Ze])),Object(J.a)((function(){return{gridContainer:{width:"100%",padding:"0px 0px 0px 20px",boxSizing:"unset"},button:{color:"black","& svg":{height:"20px",width:"20px"}},fieldWrapper:{maxWidth:"75%"},buttonWrapper:{maxWidth:"26px"}}})));function et(e){var t,r=Ye(),n=Object(i.c)(),o=e.index,c=e.addNewSearchFieldHandler,u=e.currentStops,l=e.removeSearchFieldHandler,s=e.searchStopsHandler,d=e.singleStop,p=e.processHighlightedResultSelectHandler,f=e.onFieldFocusHandler,m=e.onZoomRouteClick,h=e.isActiveRoute,g=e.onPanViaClick,S=e.inputReference,b=null,y=10,v="",E=null,O=""===u[o]||u.length>2&&""===u[o+1];return 0===o?(b=a.a.createElement(Te.a,{title:"Pan to the feature"},a.a.createElement(Pe.a,{onClick:function(){return g(d,o)},className:r.button,"aria-label":"Pan to the feature",size:"small"},a.a.createElement(Je.a,{fontSize:"small",color:"primary"}))),v="Start",E=a.a.createElement(Ie.a,{item:!0,xs:1,className:r.buttonWrapper},a.a.createElement(Te.a,{title:"Add Hop"},a.a.createElement(Pe.a,{onClick:function(){return c(u,o+1)},disabled:O,className:r.button,"aria-label":"Add Hop",size:"small"},a.a.createElement(He.a,{fontSize:"small"}))))):o===u.length-1?(b=a.a.createElement(Te.a,{title:"Pan to the feature"},a.a.createElement(Pe.a,{onClick:function(){return g(d,o)},className:r.button,"aria-label":"Pan to the feature",size:"small"},a.a.createElement(Ge.a,{color:"primary"}))),v="End",E=a.a.createElement(Ie.a,{item:!0,xs:1,className:r.buttonWrapper},a.a.createElement(Te.a,{title:"Zoom to the route"},a.a.createElement(Pe.a,{onClick:function(){return m()},disabled:!h,className:r.button,"aria-label":"Zoom to the route",size:"small"},a.a.createElement(We.a,{fontSize:"small"}))))):(b=a.a.createElement(Te.a,{title:"Pan to the feature"},a.a.createElement(Pe.a,{onClick:function(){return g(d,o)},className:r.button,"aria-label":"Pan to the feature",size:"small"},a.a.createElement(_e.a,{fontSize:"small",color:"primary"}))),y=9,v="Hop",E=a.a.createElement(a.a.Fragment,null,a.a.createElement(Ie.a,{item:!0,xs:1,className:r.buttonWrapper},a.a.createElement(Te.a,{title:"Add Hop"},a.a.createElement(Pe.a,{disabled:O,onClick:function(){return c(u,o+1)},className:r.button,"aria-label":"addHop",size:"small"},a.a.createElement(He.a,{fontSize:"small"})))),a.a.createElement(Ie.a,{item:!0,xs:1,className:r.buttonWrapper},a.a.createElement(Te.a,{title:"Remove Hop"},a.a.createElement(Pe.a,{onClick:function(){return l(o)},className:r.button,"aria-label":"removeHop",size:"small"},a.a.createElement(Ue.a,{fontSize:"small"})))))),a.a.createElement(Ie.a,{container:!0,spacing:1,className:r.gridContainer,alignItems:"flex-end"},a.a.createElement(Ie.a,{item:!0,xs:1},b),a.a.createElement(Ie.a,{item:!0,xs:y,className:r.fieldWrapper},a.a.createElement(Le.a,{style:{width:"100%"},inputRef:S,label:v,color:"primary",onChange:function(e){return s(e,o)},value:(t=d,Array.isArray(t)?Ee(t):t),onKeyDown:p,onFocus:function(){n(ie(!0)),f(o)},onBlur:function(){return setTimeout((function(){n(ie(!1))}),500)},onClick:function(e){e.target.select&&e.target.select()}})),E)}et.defaultProps={currentStops:[],singleStop:""};var tt=et;function rt(e){var t=e.children,r=e.value,n=e.index;return a.a.createElement(Q.a,{component:"div",role:"tabpanel",hidden:r!==n,id:re()(),"aria-labelledby":"simple-tab-".concat(n)},r===n&&t)}var nt=Object(J.a)((function(){return{tabs:{width:"75%"},tab:{minWidth:"33%",width:"33%"},dropDown:{width:"25%",backgroundColor:"white"},select:{height:"100%"},selectInput:{backgroundColor:"white","&:focus":{backgroundColor:"white"}},checkbox:{padding:"20px 23px"}}})),at=new AbortController;function ot(e){var t=e.mots,r=e.stationSearchUrl,o=e.APIKey,c=e.isActiveRoute,u=e.onZoomRouteClick,l=e.onPanViaClick,d=nt(),p=Object(i.c)(),f=function(e,t){var r=[];return e.filter((function(e){return t.includes(e)})).forEach((function(e){var n=t.find((function(t){return t===e}));n&&r.push({name:n,icon:ve(n)})})),0===r.length&&r.push({name:de[0],icon:ve(de[0])}),r},m=f(t,le),h=f(t,se),g=Object(i.d)((function(e){return e.MapReducer.clickLocation})),S=Object(i.d)((function(e){return e.MapReducer.currentStops})),b=Object(i.d)((function(e){return e.MapReducer.showLoadingBar})),y=Object(i.d)((function(e){return e.MapReducer.currentStopsGeoJSON})),v=a.a.useRef([]);v.current.length!==S.length&&(v.current=Array(S.length).fill().map((function(e,t){return v.current[t]||a.a.createRef()})));var E=Object(n.useState)(m),O=Object(D.a)(E,1)[0],w=Object(n.useState)(m[0].name),k=Object(D.a)(w,2),C=k[0],j=k[1],R=Object(n.useState)(h),N=Object(D.a)(R,1)[0],x=Object(n.useState)(null),F=Object(D.a)(x,2),I=F[0],L=F[1],P=Object(n.useState)([]),T=Object(D.a)(P,2),A=T[0],M=T[1],G=a.a.useState(!0),V=Object(D.a)(G,2),H=V[0],z=V[1],U=Object(n.useState)(0),J=Object(D.a)(U,2),Q=J[0],te=J[1],re=Object(n.useState)(void 0),fe=Object(D.a)(re,2),me=fe[0],he=fe[1];Object(n.useEffect)((function(){p(oe(O[0].name))}),[]);var ge=function(e,t,r){p(ne(e)),p(ae(t)),te(r)},Se=function(e,t){var r=_.a.clone(y),n={type:"FeatureCollection",features:[{type:"Feature",properties:{id:g.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:g}}]};r[Q]=n,ge(e,r,t),p(ae(r))};Object(n.useEffect)((function(){if(g)if(""===S[Q]){S[Q]=g,Se(S,Q+1<S.length?Q+1:Q)}else{var e=S,t=Q;e[Q]=g,Se(e,Q);var r=_.a.clone(y),n={type:"FeatureCollection",features:[{type:"Feature",properties:{id:g.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:g}}]};r[Q]=n,ge(e,r,t),p(ae(r))}}),[g]);var be=function(e,t){he(null),j(t),p(oe(t))},Ee=function(e){te(e),p(ie(!0))},Oe=function(e,t){var r=_.a.clone(S),n=_.a.clone(y);(r.splice(t,0,""),n[t])&&Object.keys(n).filter((function(e){return e>=t})).reverse().forEach((function(e){n["".concat(parseInt(e,10)+1)]=n[e]}));p(ne(r)),p(ae(n))},we=function(e){var t=_.a.clone(S),r=_.a.clone(y);if(t.splice(e,1),r[e]){var n=Object.keys(r);n.forEach((function(t){var n=parseInt(t,10);n===e?delete r[e]:n>e&&(r[n-1]=r[n])})),delete r[n.length-1]}p(ne(t)),p(ae(r))},ke=function(e,t){if(L(t),!e.target.value){var n=S;return n[t]="",M([]),p(ne(n)),void p(ue(!1))}var a=_.a.clone(S);a[t]=e.target.value,p(ne(a)),p(ue(!0)),at.abort();var c=(at=new AbortController).signal,i="".concat(r,"?q=").concat(e.target.value,"&key=").concat(o).concat(pe.includes(C)?"":"&mots=".concat(H?C:""));fetch(i,{signal:c}).then((function(e){return e.json()})).then((function(e){e.error?p(ce("Couldn't find stations","warning")):(0===e.features.length&&p(ce("Couldn't find stations","warning")),M(e.features),p(ue(!1)))})).catch((function(e){if("AbortError"!==e.name)throw e;console.warn("Abort ".concat(i))}))},Ce=function(e){var t=Object(D.a)(A,1)[0];if("Enter"===e.key&&t){var r=S;ge[Q]=t.properties.name;var n=_.a.clone(y);n[Q]=t,p(ne(r)),M([]),p(ae(n))}if("Backspace"===e.key){var a=[];e.target.value&&(a=A);var o={};Object.keys(y).forEach((function(e){e!==Q.toString()&&(o[e]=y[e])})),M(a),p(ae(o))}};return u&&l?a.a.createElement("div",{className:"rd-routing-menu"},a.a.createElement(B.a,{square:!0,elevation:3},a.a.createElement("div",{className:"rd-routing-menu-header"},a.a.createElement(q.a,{value:!!le.includes(C)&&C,className:d.tabs,onChange:function(e,t){be(0,t)},indicatorColor:"primary",textColor:"primary","aria-label":"mots icons"},O.map((function(e){return a.a.createElement(K.a,{className:d.tab,key:"mot-".concat(e.name),value:e.name,icon:e.icon,"aria-label":e.name})}))),a.a.createElement($.a,{className:d.dropDown},a.a.createElement(X.a,{renderValue:function(e){return""!==e?e:"Other MOTs"},className:d.select,classes:{root:d.selectInput},labelId:"rd-other-mot-label",value:me||"",disableUnderline:!me,displayEmpty:!0,onChange:function(e){if(e){var t=e.target.value;be(0,t),he(t)}else he(null)}},N.map((function(e){return a.a.createElement(Z.a,{value:e.name,key:"other-mot-".concat(e.name)},e.name)}))))),a.a.createElement(rt,null,a.a.createElement(ee.a,{onDragEnd:function(e){if(e.destination){var t=_.a.clone(S),r=t.splice(e.source.index,1),n=Object(D.a)(r,1)[0];t.splice(e.destination.index,0,n);var a=_.a.clone(y),o=Object(s.a)({},a[e.source.index]);if(e.destination.index<e.source.index)Object.keys(a).filter((function(t){return parseInt(t,10)>=e.destination.index&&parseInt(t,10)<e.source.index})).reverse().forEach((function(e){a["".concat(parseInt(e,10)+1)]=a[e]})),a[e.destination.index]=o;else if(e.destination.index>e.source.index){Object.keys(a).filter((function(t){return parseInt(t,10)>=e.source.index&&parseInt(t,10)<=e.destination.index})).forEach((function(t){parseInt(t,10)===e.destination.index?a[e.destination.index]=o:a[t]=a["".concat(parseInt(t,10)+1)]}))}p(ne(t)),p(ae(a))}}},a.a.createElement(ee.c,{droppableId:"droppable"},(function(e){return a.a.createElement("div",Object.assign({},e.droppableProps,{ref:e.innerRef,style:{background:"white"}}),S.map((function(e,t){return a.a.createElement(ee.b,{key:"searchField-".concat(t),draggableId:"searchField-".concat(t),index:t},(function(r,n){return a.a.createElement("div",Object.assign({ref:r.innerRef},r.draggableProps,r.dragHandleProps,{style:(o=n.isDragging,i=r.draggableProps.style,Object(s.a)({userSelect:"none",background:o?"#ededed":"white"},i))}),a.a.createElement(tt,{key:"searchField-".concat(t),index:t,inputReference:v.current[t],addNewSearchFieldHandler:Oe,currentStops:S,removeSearchFieldHandler:we,searchStopsHandler:ke,singleStop:e,processHighlightedResultSelectHandler:Ce,onFieldFocusHandler:Ee,onZoomRouteClick:u,onPanViaClick:l,isActiveRoute:c}));var o,i}))})),e.placeholder)}))),a.a.createElement("div",{className:"rd-mot-checkbox"},a.a.createElement(W.a,{className:d.checkbox,checked:H,onChange:function(){z(!H),null!==I&&ke({target:{value:v.current[I].current.value}},I)},color:"primary",inputProps:{"aria-label":"use only mot"}}),a.a.createElement("span",null,"Search only selected mode of transport"))),b?a.a.createElement(Y.a,null):null),a.a.createElement(Fe,{currentSearchResults:A,processClickedResultHandler:function(e){var t=S;t[Q]=e.properties.name;var r=_.a.clone(y);r[Q]=e,p(ne(t)),M([]),Object.keys(r).forEach((function(e){var t;e===Q.toString()&&(r[e].geometry.coordinates=(t=r[e].geometry.coordinates,Object(ye.n)(t,"EPSG:4326","EPSG:3857")))})),p(ae(r))}})):null}rt.defaultProps={value:null,index:null},ot.defaultProps={onZoomRouteClick:void 0,onPanViaClick:void 0};var ct=ot,it=r(176),ut=r(181),lt=r(260),st=r(222),dt=function(e){return e.map((function(e){return new it.c({stroke:new ut.a({color:e[0],width:e[1],lineDash:e[2]})})}))},pt=dt([["darkred",6],["red",3]]),ft=dt([["darkred",7],["red",4]]),mt=dt([["rgb(153,153,0)",6],["yellow",3]]),ht=dt([["rgb(153,153,0)",7],["yellow",4]]),gt=dt([["rgb(96, 186, 219)",6],["rgb(173, 216, 230)",3]]),St=dt([["rgb(96, 186, 219)",7],["rgb(173, 216, 230)",4]]),bt=dt([["grey",6],["darkgrey",3]]),yt=dt([["grey",7],["darkgrey",4]]),vt=dt([["darkblue",6],["blue",3]]),Et=dt([["darkblue",7],["blue",4]]),Ot=new it.c({image:new lt.a({radius:7,fill:new st.a({color:"red"}),stroke:new ut.a({color:"darkred",width:2})})}),wt=new it.c({image:new lt.a({radius:3,fill:new st.a({color:"rgb(173, 216, 230)"}),stroke:new ut.a({color:"rgb(96, 186, 219)",width:2})})}),kt=new it.c({image:new lt.a({radius:3,fill:new st.a({color:"darkgrey"}),stroke:new ut.a({color:"grey",width:2})})}),Ct=new it.c({image:new lt.a({radius:7,fill:new st.a({color:"yellow"}),stroke:new ut.a({color:"rgb(153,153,0)",width:2})})}),jt=new it.c({image:new lt.a({radius:7,fill:new st.a({color:"blue"}),stroke:new ut.a({color:"darkblue",width:2})})}),Rt=function(e){return"rail"===e?Ot:"bus"===e?Ct:"foot"===e?wt:"car"===e?kt:jt},Nt=function(e,t){return"rail"===e?t?ft:pt:"bus"===e?t?ht:mt:"foot"===e?t?St:gt:"car"===e?t?yt:bt:t?Et:vt},xt=(r(586),new AbortController),Ft=function(e){function t(e){var r;Object(k.a)(this,t),(r=Object(j.a)(this,Object(R.a)(t).call(this,e))).drawNewRoute=function(){var e=[],t=r.props,n=t.currentStopsGeoJSON,a=t.routingUrl,o=t.currentMot,c=t.APIKey,i=t.onShowNotification,u=t.onSetShowLoadingBar;u(!0),Object.keys(n).forEach((function(t){n[t].features?e.push("".concat(Ee(n[t].features[0].geometry.coordinates).slice().reverse())):"rail"===o||"bus"===o?e.push("!".concat(n[t].properties.uid)):e.push("".concat(n[t].properties.name))})),xt.abort();var l=(xt=new AbortController).signal,s="".concat(a,"?via=").concat(e.join("|"),"&mot=").concat(o,"&resolve-hops=false&srs=3857&key=").concat(c);fetch(s,{signal:l}).then((function(e){return e.json()})).then((function(e){if(u(!1),e.error)i("Couldn't find route","error");else{r.routeVectorSource.clear();var t=pe.includes(o)?new M.a({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}):new M.a;r.routeVectorSource.addFeatures(t.readFeatures(e)),r.setIsActiveRoute(!!r.routeVectorSource.getFeatures().length),r.routeVectorLayer.olLayer.setStyle(Nt(o,!1))}})).catch((function(e){if("AbortError"!==e.name)throw e;console.warn("Abort ".concat(s))}))};var n=r.props,a=n.APIKey,o=n.onSetClickLocation;r.hoveredFeature=null,r.hoveredRoute=null,r.initialRouteDrag=null,r.state={hoveredStationOpen:!1,hoveredStationName:"",isActiveRoute:!1,zoom:6,center:[949042.143189,5899715.591163]},r.projection="EPSG:3857";var c=new F.a(x.a.readConfig([{name:"Basemap",visible:!0,isBaseLayer:!0,data:{type:"mapbox",url:"https://maps.geops.io/styles/travic/style.json?key=".concat(a)}}]));r.markerVectorSource=new G.a({}),c.addLayer(new I.a({key:"markerLayer",name:"markerLayer",olLayer:new T.a({zIndex:1,source:r.markerVectorSource})})),r.routeVectorSource=new G.a({features:[]}),c.addLayer(new I.a({key:"routeLayer",name:"routeLayer",olLayer:new T.a({zIndex:1,source:r.routeVectorSource})})),r.markerVectorLayer=c.getLayer("markerLayer"),r.routeVectorLayer=c.getLayer("routeLayer"),r.layers=Object(w.a)(c.getLayers());var i=new V.a({layers:[r.markerVectorLayer.olLayer],hitTolerance:3});i.on("translateend",(function(e){var t,n=r.props,a=n.currentStops,o=n.currentStopsGeoJSON,c=n.onSetCurrentStops,i=n.onSetCurrentStopsGeoJSON,u=_.a.clone(a),l=_.a.clone(o),s=e.features.getArray()[0].getProperties(),d=s.name,p=s.id;if(d)t=a.indexOf(d);else{t=a.findIndex((function(e){if(!Array.isArray(e))return!1;var t=p.slice().reverse();return e[0]===t[0]&&e[1]===t[1]}))}u[t]=e.coordinate,l[t]={type:"FeatureCollection",features:[{type:"Feature",properties:{id:e.coordinate.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:e.coordinate}}]},c(u),i(l)}));var u=new H.a({source:r.routeVectorSource,pixelTolerance:2,condition:function(){var e=r.props.currentMot;return!pe.includes(e)},style:function(){var e=r.props.currentMot;return Rt(e)}});u.on("modifystart",(function(e){r.initialRouteDrag={features:e.features.getArray(),coordinate:e.mapBrowserEvent.coordinate}})),u.on("modifyend",(function(e){var t=r.initialRouteDrag.features,n=r.props,a=n.currentMot,o=n.currentStops,c=n.currentStopsGeoJSON,i=n.onSetCurrentStops,u=n.onSetCurrentStopsGeoJSON,l=_.a.clone(o),s=_.a.clone(c),d=-1;if(!pe.includes(a)){var p=t.map((function(e){return e.getGeometry()})).map((function(e){return[].concat(Object(w.a)(e.getFirstCoordinate()),Object(w.a)(e.getLastCoordinate()))})),f=r.routeVectorSource.getClosestFeatureToCoordinate(r.initialRouteDrag.coordinate).getGeometry(),m=[].concat(Object(w.a)(f.getFirstCoordinate()),Object(w.a)(f.getLastCoordinate()));p.forEach((function(e,t){e.length===m.length&&e.every((function(e,t){return e===m[t]}))&&(d=t+1)}))}if(d>=0){if(l.splice(d,0,e.mapBrowserEvent.coordinate),s[d])Object.keys(s).reverse().forEach((function(t){parseInt(t,10)>=d&&(s["".concat(parseInt(t,10)+1)]=s[t]),parseInt(t,10)===d&&(s[d]={type:"FeatureCollection",features:[{type:"Feature",properties:{id:e.mapBrowserEvent.coordinate.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:e.mapBrowserEvent.coordinate}}]})}));i(l),u(s)}r.initialRouteDrag=null}));var l=Object(z.a)().extend([i,u]);return r.map=new P.a({controls:[],interactions:l}),r.onZoomRouteClick=function(){var e;r.routeVectorSource.getFeatures().length&&(e=r.routeVectorSource.getExtent()),4===e.filter((function(e){return Number.isFinite(e)})).length&&r.map.getView().fit(r.routeVectorSource.getExtent(),{size:r.map.getSize(),duration:500,padding:[200,200,200,200]})},r.onPanViaClick=function(e,t){var n=r.props.currentStopsGeoJSON;if(n&&n[t]){var a=n[t].features?n[t].features[0].geometry.coordinates:n[t].geometry.coordinates;r.map.getView().animate({center:a,duration:500,padding:[100,100,100,100]})}},r.map.on("singleclick",(function(e){var t=r.props,n=t.isFieldFocused;(t.currentStops.includes("")||n)&&o(e.coordinate)})),r.map.on("pointermove",(function(e){var t=r.props.currentMot;r.hoveredFeature&&(r.hoveredFeature=null,r.setState({hoveredStationOpen:!1,hoveredStationName:""})),r.hoveredRoute&&(r.routeVectorLayer.olLayer.setStyle(Nt(t,!1)),r.hoveredRoute=null),r.map.getFeaturesAtPixel(e.pixel).forEach((function(e){if("Point"===e.getGeometry().getType()){r.hoveredFeature=e;var n="",a=e.get("country_code");n=e.get("name")?"".concat(e.get("name")).concat(a?" - ".concat(a):""):"".concat(Ee(e.getGeometry().flatCoordinates)),r.setState({hoveredStationOpen:!0,hoveredStationName:n})}return"LineString"===e.getGeometry().getType()&&(r.hoveredRoute=e,r.routeVectorLayer.olLayer.setStyle(Nt(t,!0))),!0}))})),r}return Object(N.a)(t,e),Object(C.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this,r=this.props,n=r.currentStopsGeoJSON,a=r.currentMot,o=a&&a!==e.currentMot,c=n&&n!==e.currentStopsGeoJSON;(o||c)&&(this.markerVectorSource.clear(),Object.keys(n).forEach((function(e){t.markerVectorSource.addFeatures((new M.a).readFeatures(n[e])),t.markerVectorSource.getFeatures().forEach((function(e){return e.setStyle(Rt(a))}))})),this.routeVectorSource.clear(),this.setIsActiveRoute(!1),Object.keys(n).length>1&&this.drawNewRoute())}},{key:"setIsActiveRoute",value:function(e){this.setState({isActiveRoute:e})}},{key:"render",value:function(){var e=this.props,t=e.mots,r=e.APIKey,n=e.stationSearchUrl,o=this.state,c=o.zoom,i=o.center,u=o.isActiveRoute,l=o.hoveredStationOpen,s=o.hoveredStationName;return a.a.createElement(a.a.Fragment,null,a.a.createElement(ct,{mots:t,stationSearchUrl:n,isActiveRoute:u,onZoomRouteClick:this.onZoomRouteClick,onPanViaClick:this.onPanViaClick,APIKey:r}),a.a.createElement(U.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:l,message:s}),a.a.createElement(L.a,{center:i,layers:this.layers,zoom:c,tabIndex:null,map:this.map,viewOptions:{projection:this.projection}}))}}]),t}(n.Component);Ft.getExtentCenter=function(e){return[e[0]+(e[2]-e[0])/2,e[1]+(e[3]-e[1])/2]},Ft.indexInGeom=function(e,t){return e.indexOf(t[0])===e.indexOf(t[1])-1};var It=Object(i.b)((function(e){return{currentMot:e.MapReducer.currentMot,currentStops:e.MapReducer.currentStops,currentStopsGeoJSON:e.MapReducer.currentStopsGeoJSON,isFieldFocused:e.MapReducer.isFieldFocused}}),(function(e){return{onSetCurrentStops:function(t){return e(ne(t))},onSetCurrentStopsGeoJSON:function(t){return e(ae(t))},onSetClickLocation:function(t){return e(function(e){return{type:"SET_CLICK_LOCATION",clickLocation:e}}(t))},onShowNotification:function(t,r){return e(ce(t,r))},onSetShowLoadingBar:function(t){return e(ue(t))}}}))(Ft),Lt=r(647),Pt=function(e){function t(e){var r;return Object(k.a)(this,t),(r=Object(j.a)(this,Object(R.a)(t).call(this,e))).handleOpen=function(){r.setState({open:!0})},r.handleClose=function(){var e=r.props.onShowNotification;r.setState({open:!1}),e(null,"error")},r.state={open:!1},r}return Object(N.a)(t,e),Object(C.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props.notificationMessage;t&&t!==e.notificationMessage&&this.handleOpen()}},{key:"render",value:function(){var e=this.props,t=e.notificationMessage,r=e.notificationType,n=this.state.open;return a.a.createElement(U.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:n,autoHideDuration:6e3,onClose:this.handleClose},a.a.createElement(Lt.a,{onClose:this.handleClose,severity:r,elevation:6,variant:"filled"},t))}}]),t}(a.a.Component),Tt=Object(i.b)((function(e){return{notificationMessage:e.MapReducer.notificationMessage,notificationType:e.MapReducer.notificationType}}),(function(e){return{onShowNotification:function(t,r){return e(ce(t,r))}}}))(Pt),At={mots:de,routingUrl:"https://api.geops.io/routing/dev/",stationSearchUrl:"https://api.geops.io/stops/dev/"};function _t(e){var t=e.mots,r=e.routingUrl,n=e.stationSearchUrl;return a.a.createElement(i.a,{store:O},a.a.createElement(It,{mots:t,routingUrl:r,APIKey:"5cc87b12d7c5370001c1d655012b7edc8da1475084e49b84b6ba658e",stationSearchUrl:n}),a.a.createElement(Tt,null))}_t.defaultProps=At;var Mt=_t;r(587),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(Mt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[373,1,2]]]);
//# sourceMappingURL=main.96fff969.chunk.js.map