(this["webpackJsonpgeops-routing-demo"]=this["webpackJsonpgeops-routing-demo"]||[]).push([[0],{180:function(e,t,n){e.exports=n(213)},185:function(e,t,n){},209:function(e,t,n){},211:function(e,t,n){},213:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(27),c=n.n(o),s=(n(185),n(89)),u=n(83),l=n(140),i=n(97),p={currentMot:"bus",currentStopsGeoJSON:{}},m=function(e,t){var n={currentStopsGeoJSON:t.currentStopsGeoJSON};return Object(i.a)({},e,{},n)},d=function(e,t){var n={currentMot:t.currentMot};return Object(i.a)({},e,{},n)},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CURRENT_STOPS_GEOJSON":return m(e,t);case"SET_CURRENT_MOT":return d(e,t);default:return e}},h=u.d,f=Object(u.c)({MapReducer:S}),v=Object(u.e)(f,h(Object(u.a)(l.a))),g=n(100),E=n(101),O=n(118),y=n(102),b=n(121),w=n(258),N=n(155),C=n(262),R=n(265),k=n(154),G=n(124),J=n(264),M=n(91),F=n.n(M),j=(n(209),n(125)),T=n(98),x=n(266),B=function(e){function t(e){var n;return Object(g.a)(this,t),(n=Object(O.a)(this,Object(y.a)(t).call(this,e))).drawNewRoute=function(){n.findRouteCancel&&n.findRouteCancel();var e=[];for(var t in n.props.currentStopsGeoJSON)e.push("!"+n.props.currentStopsGeoJSON[t].properties.id);F.a.get(n.props.routingUrl,{params:{via:e.join("|"),mot:n.props.currentMot,key:n.props.APIKey},cancelToken:new n.findRouteCancelToken((function(e){n.findRouteCancel=e}))}).then((function(e){var t=new J.a({features:(new G.a).readFeatures(e.data)}),a=new C.a({source:t,style:n.routeStyle});a.set("type","route"),n.map.addLayer(a),n.map.getView().fit(t.getExtent(),{size:n.map.getSize(),duration:500})}),(function(e){console.log(e)}))},n.removeCurrentRoute=function(){n.map.getLayers().forEach((function(e){e&&"route"===e.get("type")&&n.map.removeLayer(e)}))},n.findRouteCancelToken=F.a.CancelToken,n.findRouteCancel=null,n.routeStyle=new j.b({stroke:new T.a({color:"blue",lineDash:[4],width:3})}),n}return Object(b.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=new R.a({source:new k.a});this.map=new w.a({target:"map",layers:[e],view:new N.a({projection:"EPSG:4326",center:[10,50],zoom:6})})}},{key:"componentDidUpdate",value:function(e){var t=this;if(this.props.currentStopsGeoJSON&&this.props.currentStopsGeoJSON!==e.currentStopsGeoJSON){for(var n in this.map.getLayers().forEach((function(e){e&&"markers"===e.get("type")&&t.map.removeLayer(e)})),this.props.currentStopsGeoJSON){var a=new J.a({features:(new G.a).readFeatures(this.props.currentStopsGeoJSON[n])}),r=new C.a({source:a,style:new j.b({image:new x.a({crossOrigin:"anonymous",src:"img/map-marker.png"})})});r.set("type","markers"),this.map.addLayer(r);var o=a.getFeatures()[0].getGeometry().getCoordinates();this.map.getView().animate({center:o,duration:500})}Object.keys(this.props.currentStopsGeoJSON).length>1?this.drawNewRoute():this.removeCurrentRoute()}}},{key:"render",value:function(){return r.a.createElement("div",{id:"map",className:"MapComponent"})}}]),t}(a.Component),L=Object(s.b)((function(e){return{currentMot:e.MapReducer.currentMot,currentStopsGeoJSON:e.MapReducer.currentStopsGeoJSON}}))(B),I=n(156),_=n(253),U=n(263),H=n(254),P=n(252),z=n(260),A=n(259),D=n(257),K=n(152),q=n.n(K),V=n(150),W=n.n(V),$=n(123),Q=n.n($),X=n(153),Y=n.n(X),Z=n(149),ee=n.n(Z),te=n(151),ne=n.n(te),ae=(n(211),n(255)),re=n(256),oe=n(141),ce=n.n(oe),se=n(142),ue=n.n(se),le=n(143),ie=n.n(le),pe=n(144),me=n.n(pe),de=n(145),Se=n.n(de),he=n(146),fe=n.n(he),ve=n(147),ge=n.n(ve),Ee=n(148),Oe=n.n(Ee),ye=[{name:"bus",icon:r.a.createElement(ce.a,null)},{name:"ferry",icon:r.a.createElement(ue.a,null)},{name:"gondola",icon:r.a.createElement(ie.a,null)},{name:"tram",icon:r.a.createElement(me.a,null)},{name:"rail",icon:r.a.createElement(Se.a,null)},{name:"funicular",icon:r.a.createElement(fe.a,null)},{name:"cable_car",icon:r.a.createElement(ge.a,null)},{name:"subway",icon:r.a.createElement(Oe.a,null)}];function be(e){var t=e.children,n=e.value,a=e.index,o=Object(I.a)(e,["children","value","index"]);return r.a.createElement(P.a,Object.assign({component:"div",role:"tabpanel",hidden:n!==a,id:"simple-tabpanel-".concat(a),"aria-labelledby":"simple-tab-".concat(a)},o),n===a&&r.a.createElement(z.a,{p:3},t))}var we=function(e){function t(e){var n;Object(g.a)(this,t),(n=Object(O.a)(this,Object(y.a)(t).call(this,e))).validateMots=function(e){var t=[];return e.forEach((function(e){var n=ye.find((function(t){return t.name===e}));n&&t.push(n)})),0===t.length&&t.push(ye[0]),t},n.handleMotChange=function(e,t){n.setState({currentMot:t}),n.props.onSetCurrentMot(t)},n.onFieldFocus=function(e){n.setState({focusedFieldIndex:e})},n.onFieldBlur=function(){n.setState({focusedFieldIndex:null})},n.addNewSearchField=function(e){var t=n.state.currentStops;t.splice(e,0,""),n.setState({currentStops:t})},n.removeSearchField=function(e){var t=n.state.currentStops;t.splice(e,1);var a={};for(var r in n.state.currentStopsGeoJSON)r!==e.toString()&&(a[r]=n.state.currentStopsGeoJSON[r]);n.setState({currentStops:t,currentStopsGeoJSON:a}),n.props.onSetCurrentStopsGeoJSON(a)},n.searchStops=function(e,t){if(!e.target.value){var a=n.state.currentStops;return a[t]="",void n.setState({currentSearchResults:[],currentStops:a,showLoadingBar:!1})}var r=n.state.currentStops;r[t]=e.target.value,n.setState({currentStops:r,showLoadingBar:!0}),n.searchCancel&&n.searchCancel(),F.a.get(n.props.stationSearchUrl,{params:{q:e.target.value,key:n.props.APIKey},cancelToken:new n.searchCancelToken((function(e){n.searchCancel=e}))}).then((function(e){var t=[];e.data.features.forEach((function(e){e.properties.mot[n.state.currentMot]&&t.push(e)})),n.setState({currentSearchResults:t,showLoadingBar:!1})}),(function(e){console.log(e),n.setState({showLoadingBar:!1})}))},n.processHighlightedResultSelect=function(e){if("Enter"===e.key&&n.state.currentSearchResults[0]){var t=n.state.currentStops;t[n.state.focusedFieldIndex]=n.state.currentSearchResults[0].properties.name;var a=Object(i.a)({},n.state.currentStopsGeoJSON);a[n.state.focusedFieldIndex]=n.state.currentSearchResults[0],n.setState({currentStops:t,currentSearchResults:[],currentStopsGeoJSON:a}),n.props.onSetCurrentStopsGeoJSON(a)}if("Backspace"===e.key){var r=[];e.target.value&&(r=n.state.currentSearchResults);var o={};for(var c in n.state.currentStopsGeoJSON)c!==n.state.focusedFieldIndex.toString()&&(o[c]=n.state.currentStopsGeoJSON[c]);n.setState({currentStopsGeoJSON:o,currentSearchResults:r}),n.props.onSetCurrentStopsGeoJSON(o)}},n.processRoute=function(){n.props.onFindRoute(n.state.currentStopsGeoJSON,n.state.currentMot)};var a=n.validateMots(e.mots);return n.state={currentMots:a,currentMot:a[0].name,currentSearchResults:[],focusedFieldIndex:null,currentStops:["",""],currentStopsGeoJSON:{},showLoadingBar:!1},n.searchCancelToken=F.a.CancelToken,n.searchCancel=null,n.props.onSetCurrentMot(a[0].name),n}return Object(b.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this,t=this.state.currentStops.filter((function(e){return""!==e})).length>1;return r.a.createElement("div",{className:"RoutingMenu"},r.a.createElement(_.a,{square:!0,elevation:3},r.a.createElement(U.a,{value:this.state.currentMot,onChange:this.handleMotChange,variant:"scrollable",scrollButtons:"auto",indicatorColor:"primary",textColor:"primary","aria-label":"icon tabs example"},this.state.currentMots.map((function(e){return r.a.createElement(H.a,{key:"mot-"+e.name,value:e.name,icon:e.icon,"aria-label":e.name})}))),r.a.createElement(be,null,this.state.currentStops.map((function(n,a){var o=null,c=10,s="",u=null;return 0===a?(o=r.a.createElement(ee.a,{fontSize:"small",color:"secondary"}),s="Select start station, or click on the map",u=r.a.createElement(ae.a,{item:!0,xs:1},r.a.createElement(re.a,{onClick:function(){return e.addNewSearchField(a+1)},className:"addHop",color:"primary","aria-label":"Add Hop",component:"span"},r.a.createElement(Q.a,null)))):a===e.state.currentStops.length-1?(o=r.a.createElement(W.a,{color:"secondary"}),s="Select end station, or click on the map",u=r.a.createElement(ae.a,{item:!0,xs:1},r.a.createElement(re.a,{disabled:!t,className:"addHop",color:"primary","aria-label":"Find Route",onClick:e.processRoute,component:"span"},r.a.createElement(ne.a,null)))):(o=r.a.createElement(q.a,{fontSize:"small",color:"secondary"}),c=9,s="Select station, or click on the map",u=r.a.createElement(r.a.Fragment,null,r.a.createElement(ae.a,{item:!0,xs:1},r.a.createElement(re.a,{onClick:function(){return e.removeSearchField(a)},className:"addHop",color:"secondary","aria-label":"upload picture",component:"span"},r.a.createElement(Y.a,null))),r.a.createElement(ae.a,{item:!0,xs:1},r.a.createElement(re.a,{onClick:function(){return e.addNewSearchField(a+1)},className:"addHop",color:"primary","aria-label":"upload picture",component:"span"},r.a.createElement(Q.a,null))))),r.a.createElement(ae.a,{key:"searchField-"+a,container:!0,spacing:1,alignItems:"flex-end",style:{width:"100%"}},r.a.createElement(ae.a,{item:!0,xs:1},o),r.a.createElement(ae.a,{item:!0,xs:c},r.a.createElement(A.a,{style:{width:"100%"},label:s,color:"secondary",onChange:function(t){return e.searchStops(t,a)},value:n,onKeyDown:e.processHighlightedResultSelect,onFocus:function(){return e.onFieldFocus(a)},onBlur:e.onFieldBlur})),u)}))),this.state.showLoadingBar?r.a.createElement(D.a,null):null),0!==this.state.currentSearchResults.length?r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement(_.a,{square:!0,elevation:1},r.a.createElement(be,null,this.state.currentSearchResults.map((function(e,t){return 0!==t?r.a.createElement(P.a,{key:"searchResult-"+e.properties.name,variant:"subtitle1",gutterBottom:!0},e.properties.name):r.a.createElement(P.a,{key:"searchResult-"+e.properties.name,variant:"h6",gutterBottom:!0},e.properties.name)}))))):null)}}]),t}(r.a.Component),Ne=Object(s.b)(null,(function(e){return{onSetCurrentMot:function(t){return e(function(e){return{type:"SET_CURRENT_MOT",currentMot:e}}(t))},onSetCurrentStopsGeoJSON:function(t){return e(function(e){return{type:"SET_CURRENT_STOPS_GEOJSON",currentStopsGeoJSON:e}}(t))}}}))(we);var Ce=function(e){return r.a.createElement(s.a,{store:v},r.a.createElement(Ne,e),r.a.createElement(L,e))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Re=r.a.createElement(Ce,{mots:["rail","bus","tram"],routingUrl:"https://api.geops.io/routing/v1/",stationSearchUrl:"https://api.geops.io/stops/v1/",APIKey:"5cc87b12d7c5370001c1d655d0a18192eba64838a5fa1ad7d482ab82"});c.a.render(Re,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[180,1,2]]]);
//# sourceMappingURL=main.8c431b5c.chunk.js.map