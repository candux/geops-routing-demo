(this["webpackJsonpgeops-routing-demo"]=this["webpackJsonpgeops-routing-demo"]||[]).push([[0],{544:function(e,t,n){e.exports=n(945)},754:function(e,t,n){},942:function(e,t,n){},943:function(e,t,n){},944:function(e,t,n){},945:function(e,t,n){"use strict";n.r(t);n(545),n(554),n(744);var r=n(0),a=n.n(r),o=n(27),c=n.n(o),i=n(53),u=n(95),l=n(456),s=n(81),d={center:[949042.143189,5899715.591163],currentMot:"bus",currentStops:["",""],currentStopsGeoJSON:{},clickLocation:null,notificationMessage:"",notificationType:"info",isFieldFocused:!1,showLoadingBar:!1,selectedRoutes:[],isRouteInfoOpen:!1,dialogPosition:{x:10,y:275}},p=function(e,t){var n={center:t.center};return Object(s.a)({},e,{},n)},f=function(e,t){var n={currentStops:t.currentStops};return Object(s.a)({},e,{},n)},m=function(e,t){var n={currentStopsGeoJSON:t.currentStopsGeoJSON};return Object(s.a)({},e,{},n)},h=function(e,t){var n={currentMot:t.currentMot};return Object(s.a)({},e,{},n)},g=function(e,t){var n={clickLocation:t.clickLocation};return Object(s.a)({},e,{},n)},b=function(e,t){var n={notificationMessage:t.notificationMessage,notificationType:t.notificationType};return Object(s.a)({},e,{},n)},v=function(e,t){var n={isFieldFocused:t.isFieldFocused};return Object(s.a)({},e,{},n)},S=function(e,t){var n={showLoadingBar:t.showLoadingBar};return Object(s.a)({},e,{},n)},y=function(e,t){var n={selectedRoutes:t.selectedRoutes};return Object(s.a)({},e,{},n)},E=function(e,t){var n={isRouteInfoOpen:t.isRouteInfoOpen};return Object(s.a)({},e,{},n)},O=function(e,t){var n={dialogPosition:t.dialogPosition};return Object(s.a)({},e,{},n)},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CENTER":return p(e,t);case"SET_CURRENT_STOPS":return f(e,t);case"SET_CURRENT_STOPS_GEOJSON":return m(e,t);case"SET_CURRENT_MOT":return h(e,t);case"SET_CLICK_LOCATION":return g(e,t);case"SHOW_NOTIFICATION":return b(e,t);case"SET_IS_FIELD_FOCUSED":return v(e,t);case"SET_SHOW_LOADING_BAR":return S(e,t);case"SET_SELECTED_ROUTES":return y(e,t);case"SET_IS_ROUTE_INFO_OPEN":return E(e,t);case"SET_DIALOG_POSITION":return O(e,t);default:return e}},j=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||u.d,k=Object(u.c)({MapReducer:w}),R=Object(u.e)(k,j(Object(u.a)(l.a))),C=n(69),N=n(176),P=n(120),x=n(247),I=n(248),F=n(121),T=n(269),_=n(483),L=n(459),M=n(80),A=n(485),V=n(335),G=n(251),H=n(267),D=n(70),U=n.n(D),z=n(130),B=n(132),J=n(268),W=n(453),q=n(454),K=n(185),Z=n(1008),X=n(51),Y=n(991),$=n(987),Q=n(1005),ee=n(1003),te=n(998),ne=n(999),re=n(1002),ae=n(997),oe=n(275),ce=n(1001),ie=n(1e3),ue=n(1009),le=n(994),se=n(469),de=n.n(se),pe=n(470),fe=n.n(pe),me=n(274),he=n(261),ge=n.n(he),be=function(e){return{type:"SET_CURRENT_STOPS",currentStops:e}},ve=function(e){return{type:"SET_CURRENT_STOPS_GEOJSON",currentStopsGeoJSON:e}},Se=function(e){return{type:"SET_CURRENT_MOT",currentMot:e}},ye=function(e,t){return{type:"SHOW_NOTIFICATION",notificationMessage:e,notificationType:t}},Ee=function(e){return{type:"SET_IS_FIELD_FOCUSED",isFieldFocused:e}},Oe=function(e){return{type:"SET_SHOW_LOADING_BAR",showLoadingBar:e}},we=function(e){return{type:"SET_SELECTED_ROUTES",selectedRoutes:e}},je=function(e){return{type:"SET_IS_ROUTE_INFO_OPEN",isRouteInfoOpen:e}},ke=(n(754),["rail","bus","foot"]),Re=["tram","subway","gondola","funicular","ferry","car"],Ce=[].concat(ke,Re),Ne=["foot","car"],Pe=n(463),xe=n.n(Pe),Ie=n(461),Fe=n.n(Ie),Te=n(462),_e=n.n(Te),Le=n(8),Me=function(e){var t=null,n=e.charAt(0).toUpperCase()+e.slice(1);switch(e){case"rail":t=a.a.createElement(Fe.a,null);break;case"foot":t=a.a.createElement(_e.a,null);break;default:t=a.a.createElement(xe.a,null)}return a.a.createElement("span",{title:n},t)},Ae=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;return Object(Le.n)(e,"EPSG:3857","EPSG:4326").map((function(e){return e.toFixed(t)}))},Ve=n(988),Ge=n(946),He=n(990),De=n(989),Ue=n(331),ze=n.n(Ue),Be=function(e,t,n,r){var a=[];return n?a.push("".concat(n).concat(e||t?":":"").concat(e?" ".concat(e):"").concat(t?" ".concat(t):"")):a.push("".concat(e?"".concat(e):"").concat(e&&t?" ":"").concat(t?"".concat(t):"")),r&&a.push("ifopt: ".concat(r)),a.filter((function(e){return""!==e})).join(", ")};function Je(e){var t=e.currentSearchResults,n=e.processClickedResultHandler;return 0===t.length?null:a.a.createElement($.a,{square:!0,elevation:3},a.a.createElement(Ve.a,{component:"nav","aria-label":"search results"},t.map((function(e,t){return 0!==t?a.a.createElement(Ge.a,{onClick:function(){n(e)},button:!0,key:ge()()},a.a.createElement(De.a,null,a.a.createElement(ze.a,null)),a.a.createElement(He.a,{primary:e.properties.name,secondary:Be(e.properties.id,e.properties.code,e.properties.country_code,e.properties.ifopt)})):a.a.createElement(Ge.a,{onClick:function(){return n(e)},button:!0,selected:!0,key:"searchResult-".concat(e.properties.name)},a.a.createElement(De.a,null,a.a.createElement(ze.a,null)),a.a.createElement(He.a,{primary:e.properties.name,secondary:Be(e.properties.id,e.properties.code,e.properties.country_code,e.properties.ifopt)}))}))))}Je.defaultProps={currentSearchResults:[]};var We=Je,qe=n(1006),Ke=n(993),Ze=n(467),Xe=n.n(Ze),Ye=n(466),$e=n.n(Ye),Qe=n(332),et=n.n(Qe),tt=n(468),nt=n.n(tt),rt=n(465),at=n.n(rt),ot=n(1),ct=n.n(ot),it=ct.a.arrayOf(ct.a.number.isRequired).isRequired,ut=ct.a.shape({propTypeCoordinates:it,type:ct.a.string.isRequired}),lt=ct.a.shape({geometry:ut,properties:ct.a.shape({id:ct.a.oneOfType([ct.a.string.isRequired,ct.a.string.isRequired]),type:ct.a.string.isRequired}),type:ct.a.string.isRequired}),st=ct.a.shape({features:ct.a.shape({0:ct.a.oneOfType([lt,it]),1:ct.a.oneOfType([lt,it])}),type:ct.a.string.isRequired}),dt=(ct.a.shape({0:st,1:st}),ct.a.arrayOf(ct.a.oneOfType([ct.a.string.isRequired,it])),Object(Y.a)((function(){return{gridContainer:{width:"100%",padding:"0px 0px 0px 20px",boxSizing:"unset"},button:{color:"black","& svg":{height:"20px",width:"20px"}},fieldWrapper:{maxWidth:"75%"},buttonWrapper:{maxWidth:"26px"}}})));function pt(e){var t,n=dt(),r=Object(i.c)(),o=e.index,c=e.addNewSearchFieldHandler,u=e.currentStops,l=e.removeSearchFieldHandler,s=e.searchStopsHandler,d=e.singleStop,p=e.processHighlightedResultSelectHandler,f=e.onFieldFocusHandler,m=e.onPanViaClick,h=e.inputReference,g=null,b=10,v="",S=null,y=""===u[o]||u.length>2&&""===u[o+1];return 0===o?(g=a.a.createElement(ue.a,{title:"Pan to the feature"},a.a.createElement(Ke.a,{onClick:function(){return m(d,o)},className:n.button,"aria-label":"Pan to the feature",size:"small"},a.a.createElement(at.a,{fontSize:"small",color:"primary"}))),v="Start",S=a.a.createElement(le.a,{item:!0,xs:1,className:n.buttonWrapper},a.a.createElement(ue.a,{title:"Add Hop"},a.a.createElement(Ke.a,{onClick:function(){return c(u,o+1)},disabled:y,className:n.button,"aria-label":"Add Hop",size:"small"},a.a.createElement(et.a,{fontSize:"small"}))))):o===u.length-1?(g=a.a.createElement(ue.a,{title:"Pan to the feature"},a.a.createElement(Ke.a,{onClick:function(){return m(d,o)},className:n.button,"aria-label":"Pan to the feature",size:"small"},a.a.createElement($e.a,{color:"primary"}))),v="End"):(g=a.a.createElement(ue.a,{title:"Pan to the feature"},a.a.createElement(Ke.a,{onClick:function(){return m(d,o)},className:n.button,"aria-label":"Pan to the feature",size:"small"},a.a.createElement(Xe.a,{fontSize:"small",color:"primary"}))),b=9,v="Hop",S=a.a.createElement(a.a.Fragment,null,a.a.createElement(le.a,{item:!0,xs:1,className:n.buttonWrapper},a.a.createElement(ue.a,{title:"Add Hop"},a.a.createElement(Ke.a,{disabled:y,onClick:function(){return c(u,o+1)},className:n.button,"aria-label":"addHop",size:"small"},a.a.createElement(et.a,{fontSize:"small"})))),a.a.createElement(le.a,{item:!0,xs:1,className:n.buttonWrapper},a.a.createElement(ue.a,{title:"Remove Hop"},a.a.createElement(Ke.a,{onClick:function(){return l(o)},className:n.button,"aria-label":"removeHop",size:"small"},a.a.createElement(nt.a,{fontSize:"small"})))))),a.a.createElement(le.a,{container:!0,spacing:1,className:n.gridContainer,alignItems:"flex-end"},a.a.createElement(le.a,{item:!0,xs:1},g),a.a.createElement(le.a,{item:!0,xs:b,className:n.fieldWrapper},a.a.createElement(qe.a,{style:{width:"100%"},inputRef:h,label:v,color:"primary",onChange:function(e){return s(e,o)},value:(t=d,Array.isArray(t)?Ae(t):t),onKeyDown:p,onFocus:function(){r(Ee(!0)),f(o)},onBlur:function(){return setTimeout((function(){r(Ee(!1))}),500)},onClick:function(e){e.target.select&&e.target.select()}})),S)}pt.defaultProps={currentStops:[],singleStop:""};var ft=pt;function mt(e){var t=e.children,n=e.value,r=e.index;return a.a.createElement(oe.a,{component:"div",role:"tabpanel",hidden:n!==r,id:ge()(),"aria-labelledby":"simple-tab-".concat(r)},n===r&&t)}var ht=Object(Y.a)((function(){return{tabs:{width:"75%"},tab:{minWidth:"33%",width:"33%"},dropDown:{width:"25%",backgroundColor:"white"},select:{height:"100%"},selectInput:{backgroundColor:"white","&:focus":{backgroundColor:"white"}},checkbox:{margin:"0px 5px 0px 13px"}}})),gt=new AbortController;function bt(e){var t=e.mots,n=e.stationSearchUrl,o=e.APIKey,c=e.isActiveRoute,u=e.onZoomRouteClick,l=e.onPanViaClick,d=ht(),p=Object(i.c)(),f=function(e,t){var n=[];return e.filter((function(e){return t.includes(e)})).forEach((function(e){var r=t.find((function(t){return t===e}));r&&n.push({name:r,icon:Me(r)})})),0===n.length&&n.push({name:Ce[0],icon:Me(Ce[0])}),n},m=f(t,ke),h=f(t,Re),g=Object(i.d)((function(e){return e.MapReducer.center})),b=Object(i.d)((function(e){return e.MapReducer.clickLocation})),v=Object(i.d)((function(e){return e.MapReducer.currentStops})),S=Object(i.d)((function(e){return e.MapReducer.showLoadingBar})),y=Object(i.d)((function(e){return e.MapReducer.isRouteInfoOpen})),E=Object(i.d)((function(e){return e.MapReducer.currentStopsGeoJSON})),O=a.a.useRef([]);O.current.length!==v.length&&(O.current=Array(v.length).fill().map((function(e,t){return O.current[t]||a.a.createRef()})));var w=Object(r.useState)(m),j=Object(X.a)(w,1)[0],k=Object(r.useState)(m[0].name),R=Object(X.a)(k,2),C=R[0],N=R[1],P=Object(r.useState)(h),x=Object(X.a)(P,1)[0],I=Object(r.useState)(null),F=Object(X.a)(I,2),T=F[0],_=F[1],L=Object(r.useState)([]),M=Object(X.a)(L,2),A=M[0],V=M[1],G=a.a.useState(!0),H=Object(X.a)(G,2),D=H[0],z=H[1],B=Object(r.useState)(0),J=Object(X.a)(B,2),W=J[0],q=J[1],K=Object(r.useState)(void 0),Z=Object(X.a)(K,2),Y=Z[0],se=Z[1];Object(r.useEffect)((function(){p(Se(j[0].name))}),[]),Object(r.useEffect)((function(){y&&p(we([]))}),[v]);var pe=function(e,t,n){p(be(e)),p(ve(t)),q(n)},he=function(e,t){var n=U.a.clone(E),r={type:"FeatureCollection",features:[{type:"Feature",properties:{id:b.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:b}}]};n[W]=r,pe(e,n,t),p(ve(n))};Object(r.useEffect)((function(){if(b)if(""===v[W]){v[W]=b,he(v,W+1<v.length?W+1:W)}else{var e=v,t=W;e[W]=b,he(e,W);var n=U.a.clone(E),r={type:"FeatureCollection",features:[{type:"Feature",properties:{id:b.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:b}}]};n[W]=r,pe(e,n,t),p(ve(n))}}),[b]);var ge=function(e,t){se(null),N(t),p(Se(t))},Pe=function(e){q(e),p(Ee(!0))},xe=function(e,t){var n=U.a.clone(v),r=U.a.clone(E);(n.splice(t,0,""),r[t])&&Object.keys(r).filter((function(e){return e>=t})).reverse().forEach((function(e){r["".concat(parseInt(e,10)+1)]=r[e]}));p(be(n)),p(ve(r))},Ie=function(e){var t=U.a.clone(v),n=U.a.clone(E);if(t.splice(e,1),n[e]){var r=Object.keys(n);r.forEach((function(t){var r=parseInt(t,10);r===e?delete n[e]:r>e&&(n[r-1]=n[r])})),delete n[r.length-1]}p(be(t)),p(ve(n))},Fe=function(e,t){if(_(t),!e.target.value){var r=v;return r[t]="",V([]),p(be(r)),void p(Oe(!1))}var a=U.a.clone(v);a[t]=e.target.value,p(be(a)),p(Oe(!0)),gt.abort();var c=(gt=new AbortController).signal,i="".concat(n,"?q=").concat(e.target.value,"&key=").concat(o).concat(Ne.includes(C)?"":"&mots=".concat(D?C:""),"&ref_location=").concat(Ae(g).reverse().join(","));fetch(i,{signal:c}).then((function(e){return e.json()})).then((function(e){e.error?p(ye("Couldn't find stations","warning")):(0===e.features.length&&p(ye("Couldn't find stations","warning")),V(e.features),p(Oe(!1)))})).catch((function(e){if("AbortError"!==e.name)throw e;console.warn("Abort ".concat(i))}))},Te=function(e){var t=Object(X.a)(A,1)[0];if("Enter"===e.key&&t){var n=v;pe[W]=t.properties.name;var r=U.a.clone(E);r[W]=t,p(be(n)),V([]),p(ve(r))}if("Backspace"===e.key){var a=[];e.target.value&&(a=A);var o={};Object.keys(E).forEach((function(e){e!==W.toString()&&(o[e]=E[e])})),V(a),p(ve(o))}};return u&&l?a.a.createElement("div",{className:"rd-routing-menu"},a.a.createElement($.a,{square:!0,elevation:3},a.a.createElement("div",{className:"rd-routing-menu-header"},a.a.createElement(ee.a,{value:!!ke.includes(C)&&C,className:d.tabs,onChange:function(e,t){ge(0,t)},indicatorColor:"primary",textColor:"primary","aria-label":"mots icons"},j.map((function(e){return a.a.createElement(te.a,{className:d.tab,key:"mot-".concat(e.name),value:e.name,icon:e.icon,"aria-label":e.name})}))),a.a.createElement(ae.a,{className:d.dropDown},a.a.createElement(re.a,{renderValue:function(e){return""!==e?e:"Other MOTs"},className:d.select,classes:{root:d.selectInput},labelId:"rd-other-mot-label",value:Y||"",disableUnderline:!Y,displayEmpty:!0,onChange:function(e){if(e){var t=e.target.value;ge(0,t),se(t)}else se(null)}},x.map((function(e){return a.a.createElement(ne.a,{value:e.name,key:"other-mot-".concat(e.name)},e.name)}))))),a.a.createElement(mt,null,a.a.createElement(me.a,{onDragEnd:function(e){if(e.destination){var t=U.a.clone(v),n=t.splice(e.source.index,1),r=Object(X.a)(n,1)[0];t.splice(e.destination.index,0,r);var a=U.a.clone(E),o=Object(s.a)({},a[e.source.index]);if(e.destination.index<e.source.index)Object.keys(a).filter((function(t){return parseInt(t,10)>=e.destination.index&&parseInt(t,10)<e.source.index})).reverse().forEach((function(e){a["".concat(parseInt(e,10)+1)]=a[e]})),a[e.destination.index]=o;else if(e.destination.index>e.source.index){Object.keys(a).filter((function(t){return parseInt(t,10)>=e.source.index&&parseInt(t,10)<=e.destination.index})).forEach((function(t){parseInt(t,10)===e.destination.index?a[e.destination.index]=o:a[t]=a["".concat(parseInt(t,10)+1)]}))}p(be(t)),p(ve(a))}}},a.a.createElement(me.c,{droppableId:"droppable"},(function(e){return a.a.createElement("div",Object.assign({},e.droppableProps,{ref:e.innerRef,style:{background:"white"}}),v.map((function(e,t){return a.a.createElement(me.b,{key:"searchField-".concat(t),draggableId:"searchField-".concat(t),index:t},(function(n,r){return a.a.createElement("div",Object.assign({ref:n.innerRef},n.draggableProps,n.dragHandleProps,{style:(o=r.isDragging,c=n.draggableProps.style,Object(s.a)({userSelect:"none",background:o?"#ededed":"white"},c))}),a.a.createElement(ft,{key:"searchField-".concat(t),index:t,inputReference:O.current[t],addNewSearchFieldHandler:xe,currentStops:v,removeSearchFieldHandler:Ie,searchStopsHandler:Fe,singleStop:e,processHighlightedResultSelectHandler:Te,onFieldFocusHandler:Pe,onPanViaClick:l}));var o,c}))})),e.placeholder)}))),a.a.createElement("div",{className:"rd-mot-checkbox"},a.a.createElement(Q.a,{className:d.checkbox,checked:D,onChange:function(){z(!D),null!==T&&Fe({target:{value:O.current[T].current.value}},T)},color:"primary",inputProps:{"aria-label":"use only mot"}}),a.a.createElement("span",null,"Search only selected mode of transport")),a.a.createElement("div",{className:"rd-route-buttons"},a.a.createElement(le.a,{item:!0,xs:6},a.a.createElement(ue.a,{title:"Zoom to the route"},a.a.createElement(ie.a,{onClick:function(){return u()},"aria-label":"Zoom to the route",disabled:!c,variant:"contained",color:"default",classes:{root:"rd-button-root",disabled:"rd-button-disabled"},startIcon:a.a.createElement(de.a,{fontSize:"small"})},a.a.createElement(oe.a,null,"Zoom to the route")))),a.a.createElement(le.a,{item:!0,xs:6},a.a.createElement(ue.a,{title:"Route information"},a.a.createElement(ie.a,{onClick:function(){p(je(!y))},"aria-label":"Route information",disabled:!c,variant:"contained",color:"default",className:y?"rd-button-active":"",classes:{root:"rd-button-root",disabled:"rd-button-disabled"},startIcon:a.a.createElement(fe.a,{fontSize:"small"})},a.a.createElement(oe.a,null,"Route information")))))),S?a.a.createElement(ce.a,null):null),a.a.createElement(We,{currentSearchResults:A,processClickedResultHandler:function(e){var t=v;t[W]=e.properties.name;var n=U.a.clone(E);n[W]=e,p(be(t)),V([]),Object.keys(n).forEach((function(e){var t;e===W.toString()&&(n[e].geometry.coordinates=(t=n[e].geometry.coordinates,Object(Le.n)(t,"EPSG:4326","EPSG:3857")))})),p(ve(n))}})):null}mt.defaultProps={value:null,index:null},bt.defaultProps={onZoomRouteClick:void 0,onPanViaClick:void 0};var vt=bt,St=n(158),yt=n(471),Et=n.n(yt),Ot=n(472),wt=n.n(Ot),jt=n(458),kt=n(484),Rt=n(115),Ct=(n(942),function(e,t){return"".concat(t?Math.round(100*e)/100:Math.round(e/1e3*100)/100)}),Nt=function(e,t,n){for(var r=[],a=n||0;a<e.length;a+=t||1)r.push(e[a]);return r},Pt=function(e,t){var n=e/t*300;return n>=80?n:80};function xt(e){var t,n,o=e.routes,c=e.hoveredCoords,u=e.onHighlightPoint,l=e.clearHighlightPoint,s=Object(i.c)(),d=Object(r.useState)(null),p=Object(X.a)(d,2),f=p[0],m=p[1],h=Object(r.useState)(null),g=Object(X.a)(h,2),b=g[0],v=g[1],S=Object(r.useState)(null),y=Object(X.a)(S,2),E=y[0],O=y[1],w=Object(r.useState)([]),j=Object(X.a)(w,2),k=j[0],R=j[1],N=Object(r.useState)(null),P=Object(X.a)(N,2),x=P[0],I=P[1],F=Object(r.useState)(null),T=Object(X.a)(F,2),_=T[0],L=T[1],M=Object(i.d)((function(e){return e.MapReducer.dialogPosition}));return Object(r.useEffect)((function(){var e,t=[],n=(e=[]).concat.apply(e,Object(C.a)(o.map((function(e){return e.getGeometry().getFlatCoordinates()})))),r=new jt.a(o.map((function(e){return e.getGeometry()}))),a=Object(St.b)(r);v(a),I(a>1e3?"km":"m"),L("m"===x);var c=Nt(n,3,0),i=Nt(n,3,1),u=Nt(n,3,2);O(Math.max.apply(Math,Object(C.a)(u))),u.forEach((function(e,n){t.push({alt:e,xVal:c[n],yVal:i[n],distance:a*(n/(u.length-1))})})),R(t)}),[o]),a.a.createElement(kt.a,{isOpen:!0,title:a.a.createElement("span",null,"Route information"),isDraggable:!0,onDragStop:function(e,t){s(function(e){return{type:"SET_DIALOG_POSITION",dialogPosition:e}}({x:t.lastX,y:t.lastY}))},className:"rd-dialog-container",classNameHeader:"rd-dialog-header",classNameCloseBt:"rd-dialog-close-bt",cancelDraggable:".tm-dialog-body",position:M,onClose:function(){return s(je(!1))}},a.a.createElement(Rt.d,{width:450,height:220,data:k,onMouseLeave:l},a.a.createElement(Rt.i,{axisLine:!1,tickLine:!1},a.a.createElement(Rt.b,{value:"m",offset:10,position:"top"})),a.a.createElement(Rt.h,{type:"number",dataKey:"distance",tickFormatter:function(e){return Ct(e,_)}},a.a.createElement(Rt.b,{value:x,offset:10,position:"right"})),a.a.createElement(Rt.a,{vertical:!1}),a.a.createElement(Rt.c,{type:"monotone",dataKey:"alt",dot:!1,stroke:"#3f51b5",strokeWidth:2}),c&&f&&a.a.createElement(Rt.f,{x:f.distance,stroke:"lightgrey"}),c&&f&&a.a.createElement(Rt.e,{r:4,x:f.distance,y:f.alt,fill:"#3f51b5",stroke:"white"}),a.a.createElement(Rt.g,{cursor:!!f||"auto",position:f?{x:Pt(f.distance,b),y:(t=f.alt,n=E,t/n>.5?110:20)}:"auto",content:function(e){return c?function(e,t,n){for(var r=new B.a,o=wt()(r.writeFeaturesObject(n,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})).features[0],c=new G.a({geometry:new z.a(e)}),i=r.writeFeatureObject(c,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),u=Et()(o,i),l=o.geometry.coordinates,s=l.map((function(e){return e[u.properties.index]})),d=s.reduce((function(e,t){var n=u.geometry.coordinates[0];return e?t&&e&&Math.abs(t[0]-n)<Math.abs(e[0]-n)?t:e:t})),p=s.indexOf(d),f=u.properties.index,h=0;h<p;h+=1)f+=l[h].length;var g=t[f];return m(g),g?a.a.createElement("div",{className:"rd-tootip-wrapper"},a.a.createElement("div",null,"altitude: ",g.alt," m"),a.a.createElement("div",null,"distance: ",Ct(g.distance,_),_?" m":" km")):null}(c,k,o):function(e){if(f&&m(null),e.payload.length){var t=e.payload[0].payload,n=t.xVal,r=t.yVal,o=t.alt,c=t.distance;return u([n,r]),a.a.createElement("div",{className:"rd-tootip-wrapper"},a.a.createElement("div",null,"altitude: ",o," m"),a.a.createElement("div",null,"distance: ",Ct(c,_),_?" m":" km"))}}(e)}})))}xt.defaultProps={hoveredCoords:null};var It=a.a.memo(xt),Ft=n(209),Tt=n(215),_t=n(336),Lt=n(272),Mt=function(e){return e.map((function(e){return new Ft.c({stroke:new Tt.a({color:e[0],width:e[1],lineDash:e[2]})})}))},At=Mt([["darkred",6],["red",3]]),Vt=Mt([["darkred",7],["red",4]]),Gt=Mt([["rgb(153,153,0)",6],["yellow",3]]),Ht=Mt([["rgb(153,153,0)",7],["yellow",4]]),Dt=Mt([["rgb(96, 186, 219)",6],["rgb(173, 216, 230)",3]]),Ut=Mt([["rgb(96, 186, 219)",7],["rgb(173, 216, 230)",4]]),zt=Mt([["grey",6],["darkgrey",3]]),Bt=Mt([["grey",7],["darkgrey",4]]),Jt=Mt([["darkblue",6],["blue",3]]),Wt=Mt([["darkblue",7],["blue",4]]),qt=new Ft.c({image:new _t.a({radius:7,fill:new Lt.a({color:"red"}),stroke:new Tt.a({color:"darkred",width:2})})}),Kt=new Ft.c({image:new _t.a({radius:3,fill:new Lt.a({color:"rgb(173, 216, 230)"}),stroke:new Tt.a({color:"rgb(96, 186, 219)",width:2})})}),Zt=new Ft.c({image:new _t.a({radius:3,fill:new Lt.a({color:"darkgrey"}),stroke:new Tt.a({color:"grey",width:2})})}),Xt=new Ft.c({image:new _t.a({radius:7,fill:new Lt.a({color:"yellow"}),stroke:new Tt.a({color:"rgb(153,153,0)",width:2})})}),Yt=new Ft.c({image:new _t.a({radius:7,fill:new Lt.a({color:"blue"}),stroke:new Tt.a({color:"darkblue",width:2})})}),$t=function(e){return"rail"===e?qt:"bus"===e?Xt:"foot"===e?Kt:"car"===e?Zt:Yt},Qt=function(e,t){return"rail"===e?t?Vt:At:"bus"===e?t?Ht:Gt:"foot"===e?t?Ut:Dt:"car"===e?t?Bt:zt:t?Wt:Jt},en=(n(943),new AbortController),tn=function(e){function t(e){var n;Object(N.a)(this,t),(n=Object(x.a)(this,Object(I.a)(t).call(this,e))).onMapMoved=function(e){var t=n.props,r=t.center,a=t.onSetCenter,o=e.map.getView().getCenter();r[0]===o[0]&&r[1]===o[1]||a(o)},n.drawNewRoute=function(){var e=[],t=n.props,r=t.currentStopsGeoJSON,a=t.routingUrl,o=t.currentMot,c=t.APIKey,i=t.onShowNotification,u=t.onSetShowLoadingBar,l=t.onSetSelectedRoutes;u(!0),Object.keys(r).forEach((function(t){r[t].features?e.push("".concat(Ae(r[t].features[0].geometry.coordinates).slice().reverse())):Ne.includes(o)?e.push("".concat(r[t].properties.name)):e.push("!".concat(r[t].properties.uid))})),en.abort();var s=(en=new AbortController).signal,d="".concat(a,"?via=").concat(e.join("|"),"&mot=").concat(o,"&resolve-hops=false&key=").concat(c,"&elevation=1");fetch(d,{signal:s}).then((function(e){return e.json()})).then((function(e){if(u(!1),e.error)return i("Couldn't find route","error"),void l([]);n.routeVectorSource.clear();var t=new B.a({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});n.routeVectorSource.addFeatures(t.readFeatures(e)),n.setIsActiveRoute(!!n.routeVectorSource.getFeatures().length),l(n.routeVectorSource.getFeatures()),n.routeVectorLayer.olLayer.setStyle(Qt(o,!1))})).catch((function(e){if("AbortError"!==e.name)throw u(!1),l([]),e;console.warn("Abort ".concat(d))}))};var a=n.props,o=a.APIKey,c=a.onSetClickLocation;n.mapRef=Object(r.createRef)(),n.hoveredFeature=null,n.hoveredRoute=null,n.initialRouteDrag=null,n.state={hoveredStationOpen:!1,hoveredStationName:"",isActiveRoute:!1,hoveredPoint:null},n.onHighlightPoint=n.onHighlightPoint.bind(Object(F.a)(n)),n.projection="EPSG:3857";var i=new L.a(_.a.readConfig([{name:"Basemap",visible:!0,isBaseLayer:!0,data:{type:"mapbox",url:"https://maps.geops.io/styles/travic/style.json?key=".concat(o)}}]));n.routeVectorSource=new J.a({features:[]}),i.addLayer(new M.a({key:"routeLayer",name:"routeLayer",olLayer:new H.a({zIndex:1,source:n.routeVectorSource})})),n.highlightVectorSource=new J.a({}),i.addLayer(new M.a({key:"highlightLayer",name:"highlightLayer",olLayer:new H.a({zIndex:1,source:n.highlightVectorSource})})),n.markerVectorSource=new J.a({}),i.addLayer(new M.a({key:"markerLayer",name:"markerLayer",olLayer:new H.a({zIndex:1,source:n.markerVectorSource})})),n.markerVectorLayer=i.getLayer("markerLayer"),n.routeVectorLayer=i.getLayer("routeLayer"),n.layers=Object(C.a)(i.getLayers());var u=new W.a({layers:[n.markerVectorLayer.olLayer],hitTolerance:3});u.on("translateend",(function(e){var t,r=n.props,a=r.currentStops,o=r.currentStopsGeoJSON,c=r.onSetCurrentStops,i=r.onSetCurrentStopsGeoJSON,u=U.a.clone(a),l=U.a.clone(o),s=e.features.getArray()[0].getProperties(),d=s.name,p=s.id;if(d)t=a.indexOf(d);else{t=a.findIndex((function(e){if(!Array.isArray(e))return!1;var t=p.slice().reverse();return e[0]===t[0]&&e[1]===t[1]}))}u[t]=e.coordinate,l[t]={type:"FeatureCollection",features:[{type:"Feature",properties:{id:e.coordinate.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:e.coordinate}}]},c(u),i(l)}));var l=new q.a({source:n.routeVectorSource,pixelTolerance:4,condition:function(){var e=n.props.currentMot;return!Ne.includes(e)},style:function(){var e=n.props.currentMot;return $t(e)}});l.on("modifystart",(function(e){n.initialRouteDrag={features:e.features.getArray(),coordinate:e.mapBrowserEvent.coordinate}})),l.on("modifyend",(function(e){var t=n.initialRouteDrag.features,r=n.props,a=r.currentMot,o=r.currentStops,c=r.currentStopsGeoJSON,i=r.onSetCurrentStops,u=r.onSetCurrentStopsGeoJSON,l=U.a.clone(o),s=U.a.clone(c),d=-1;if(!Ne.includes(a)){var p=t.map((function(e){return e.getGeometry()})).map((function(e){return[].concat(Object(C.a)(e.getFirstCoordinate()),Object(C.a)(e.getLastCoordinate()))})),f=n.routeVectorSource.getClosestFeatureToCoordinate(n.initialRouteDrag.coordinate).getGeometry(),m=[].concat(Object(C.a)(f.getFirstCoordinate()),Object(C.a)(f.getLastCoordinate()));p.forEach((function(e,t){e.length===m.length&&e.every((function(e,t){return e===m[t]}))&&(d=t+1)}))}if(d>=0){if(l.splice(d,0,e.mapBrowserEvent.coordinate),s[d])Object.keys(s).reverse().forEach((function(t){parseInt(t,10)>=d&&(s["".concat(parseInt(t,10)+1)]=s[t]),parseInt(t,10)===d&&(s[d]={type:"FeatureCollection",features:[{type:"Feature",properties:{id:e.mapBrowserEvent.coordinate.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:e.mapBrowserEvent.coordinate}}]})}));i(l),u(s)}n.initialRouteDrag=null}));var s=Object(K.a)().extend([u,l]);return n.map=new V.a({controls:[],interactions:s}),n.onZoomRouteClick=function(){var e;n.routeVectorSource.getFeatures().length&&(e=n.routeVectorSource.getExtent()),4===e.filter((function(e){return Number.isFinite(e)})).length&&n.map.getView().fit(n.routeVectorSource.getExtent(),{size:n.map.getSize(),duration:500,padding:[200,200,200,200]})},n.onPanViaClick=function(e,t){var r=n.props.currentStopsGeoJSON;if(r&&r[t]){var a=r[t].features?r[t].features[0].geometry.coordinates:r[t].geometry.coordinates;n.map.getView().animate({center:a,duration:500,padding:[100,100,100,100]})}},n.map.on("singleclick",(function(e){var t=n.props,r=t.isFieldFocused;(t.currentStops.includes("")||r)&&c(e.coordinate)})),n.map.on("pointermove",(function(e){var t=n.props.currentMot;n.hoveredFeature&&(n.hoveredFeature=null,n.setState({hoveredStationOpen:!1,hoveredStationName:""})),n.hoveredRoute&&(n.routeVectorLayer.olLayer.setStyle(Qt(t,!1)),n.hoveredRoute=null,n.setState({hoveredPoint:null})),n.map.getFeaturesAtPixel(e.pixel,{hitTolerance:2}).forEach((function(t){if("Point"===t.getGeometry().getType()){n.hoveredFeature=t;var r="",a=t.get("country_code");r=t.get("name")?"".concat(t.get("name")).concat(a?" - ".concat(a):""):"".concat(Ae(t.getGeometry().flatCoordinates)),n.setState({hoveredStationOpen:!0,hoveredStationName:r})}return"LineString"===t.getGeometry().getType()&&(n.hoveredRoute=t,n.setState({hoveredPoint:e.coordinate})),!0}))})),n}return Object(T.a)(t,e),Object(P.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this,n=this.props,r=n.currentStopsGeoJSON,a=n.currentMot,o=a&&a!==e.currentMot,c=r&&r!==e.currentStopsGeoJSON;(o||c)&&(this.markerVectorSource.clear(),Object.keys(r).forEach((function(e){t.markerVectorSource.addFeatures((new B.a).readFeatures(r[e])),t.markerVectorSource.getFeatures().forEach((function(e){return e.setStyle($t(a))}))})),this.routeVectorSource.clear(),this.setIsActiveRoute(!1),Object.keys(r).length>1&&this.drawNewRoute())}},{key:"onHighlightPoint",value:function(e){var t=this.props.currentMot;this.highlightVectorSource.clear();var n=new G.a({geometry:new z.a(e)});n.setStyle($t(t)),this.highlightVectorSource.addFeatures([n])}},{key:"onFeaturesHover",value:function(e){this.mapRef&&(this.mapRef.current.node.current.style.cursor=e.length?"pointer":"inherit")}},{key:"setIsActiveRoute",value:function(e){this.setState({isActiveRoute:e})}},{key:"render",value:function(){var e=this,t=this.props,n=t.center,r=t.mots,o=t.APIKey,c=t.selectedRoutes,i=t.isRouteInfoOpen,u=t.stationSearchUrl,l=this.state,s=l.isActiveRoute,d=l.hoveredPoint,p=l.hoveredStationOpen,f=l.hoveredStationName;return a.a.createElement(a.a.Fragment,null,a.a.createElement(vt,{mots:r,stationSearchUrl:u,isActiveRoute:s,onZoomRouteClick:this.onZoomRouteClick,onPanViaClick:this.onPanViaClick,APIKey:o}),a.a.createElement(Z.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:p,message:f}),a.a.createElement(A.a,{ref:this.mapRef,center:n,layers:this.layers,onMapMoved:function(t){return e.onMapMoved(t)},onFeaturesHover:function(t){return e.onFeaturesHover(t)},zoom:6,tabIndex:null,map:this.map,viewOptions:{projection:this.projection}}),i&&c.length?a.a.createElement(It,{routes:c,hoveredCoords:d,onHighlightPoint:this.onHighlightPoint,clearHighlightPoint:function(){e.highlightVectorSource.clear()}}):null)}}]),t}(r.Component);tn.getExtentCenter=function(e){return[e[0]+(e[2]-e[0])/2,e[1]+(e[3]-e[1])/2]},tn.indexInGeom=function(e,t){return e.indexOf(t[0])===e.indexOf(t[1])-1};var nn=Object(i.b)((function(e){return{center:e.MapReducer.center,selectedRoutes:e.MapReducer.selectedRoutes,isRouteInfoOpen:e.MapReducer.isRouteInfoOpen,currentMot:e.MapReducer.currentMot,currentStops:e.MapReducer.currentStops,currentStopsGeoJSON:e.MapReducer.currentStopsGeoJSON,isFieldFocused:e.MapReducer.isFieldFocused}}),(function(e){return{onSetCenter:function(t){return e(function(e){return{type:"SET_CENTER",center:e}}(t))},onSetCurrentStops:function(t){return e(be(t))},onSetCurrentStopsGeoJSON:function(t){return e(ve(t))},onSetClickLocation:function(t){return e(function(e){return{type:"SET_CLICK_LOCATION",clickLocation:e}}(t))},onShowNotification:function(t,n){return e(ye(t,n))},onSetShowLoadingBar:function(t){return e(Oe(t))},onSetSelectedRoutes:function(t){return e(we(t))}}}))(tn),rn=n(1004),an=function(e){function t(e){var n;return Object(N.a)(this,t),(n=Object(x.a)(this,Object(I.a)(t).call(this,e))).handleOpen=function(){n.setState({open:!0})},n.handleClose=function(){var e=n.props.onShowNotification;n.setState({open:!1}),e(null,"error")},n.state={open:!1},n}return Object(T.a)(t,e),Object(P.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props.notificationMessage;t&&t!==e.notificationMessage&&this.handleOpen()}},{key:"render",value:function(){var e=this.props,t=e.notificationMessage,n=e.notificationType,r=this.state.open;return a.a.createElement(Z.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:r,autoHideDuration:6e3,onClose:this.handleClose},a.a.createElement(rn.a,{onClose:this.handleClose,severity:n,elevation:6,variant:"filled"},t))}}]),t}(a.a.Component),on=Object(i.b)((function(e){return{notificationMessage:e.MapReducer.notificationMessage,notificationType:e.MapReducer.notificationType}}),(function(e){return{onShowNotification:function(t,n){return e(ye(t,n))}}}))(an),cn={mots:Ce,routingUrl:"https://api.geops.io/routing/v1/",stationSearchUrl:"https://api.geops.io/stops/v1/"};function un(e){var t=e.mots,n=e.routingUrl,r=e.stationSearchUrl;return a.a.createElement(i.a,{store:R},a.a.createElement(nn,{mots:t,routingUrl:n,APIKey:"5cc87b12d7c5370001c1d655012b7edc8da1475084e49b84b6ba658e",stationSearchUrl:r}),a.a.createElement(on,null))}un.defaultProps=cn;var ln=un;n(944),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(ln,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[544,1,2]]]);
//# sourceMappingURL=main.5a3f4842.chunk.js.map